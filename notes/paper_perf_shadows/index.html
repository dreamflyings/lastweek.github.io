



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://lastweek.io/notes/paper_perf_shadows/">
      
      
        <meta name="author" content="Yizhou Shan">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.2">
    
    
      
        <title>Perf Shadows - Yizhou Shan's Home Page</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.9b572555.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700|Courier">
        <style>body,input{font-family:"","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Courier","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#hiding-in-the-shadows" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://lastweek.io" title="Yizhou Shan's Home Page" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Yizhou Shan's Home Page
              </span>
              <span class="md-header-nav__topic">
                Perf Shadows
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Yizhou Shan's Home Page
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../benchmark/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Perf Shadows
      </label>
    
    <a href="./" title="Perf Shadows" class="md-nav__link md-nav__link--active">
      Perf Shadows
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nanoseconds" title="Nanoseconds" class="md-nav__link">
    Nanoseconds
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runahead" title="Runahead" class="md-nav__link">
    Runahead
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-threads-or-precomputation" title="Helper Threads (or Precomputation)" class="md-nav__link">
    Helper Threads (or Precomputation)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-level-speculation" title="Thread-Level Speculation" class="md-nav__link">
    Thread-Level Speculation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locks" title="Locks" class="md-nav__link">
    Locks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc" title="Misc" class="md-nav__link">
    Misc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-it-all-together" title="Put it all together" class="md-nav__link">
    Put it all together
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microseconds" title="Microseconds" class="md-nav__link">
    Microseconds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#milliseconds" title="Milliseconds" class="md-nav__link">
    Milliseconds
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cache_coherence/" title="Cache Coherence" class="md-nav__link">
      Cache Coherence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paper_fpga/" title="Papers of FPGA" class="md-nav__link">
      Papers of FPGA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../proc/" title="[Linux] Special Files" class="md-nav__link">
      [Linux] Special Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rmap/" title="[Linux] Reverse Mmap (rmap)" class="md-nav__link">
      [Linux] Reverse Mmap (rmap)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trace/" title="[Linux] Trace/Profile" class="md-nav__link">
      [Linux] Trace/Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cgroup-swap/" title="[Linux] Cgroup and Swap" class="md-nav__link">
      [Linux] Cgroup and Swap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../userfaultfd/" title="[Linux] Userfaultfd" class="md-nav__link">
      [Linux] Userfaultfd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xperf/" title="[Linux] User/kern Cross Perf" class="md-nav__link">
      [Linux] User/kern Cross Perf
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kvm-basic/" title="[Linux] KVM" class="md-nav__link">
      [Linux] KVM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/essential/" title="Essential" class="md-nav__link">
      Essential
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/cheatsheet/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-14" type="checkbox" id="nav-2-14">
    
    <label class="md-nav__link" for="nav-2-14">
      Log
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-14">
        Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../general_log/0919/" title="Sep 2019" class="md-nav__link">
      Sep 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../general_log/0819/" title="Aug 2019" class="md-nav__link">
      Aug 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../general_log/0719/" title="Jul 2019" class="md-nav__link">
      Jul 2019
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      FPGA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        FPGA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/hls_axi/" title="HLS: Usage of AXI-Stream" class="md-nav__link">
      HLS: Usage of AXI-Stream
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/hls_axi/" title="HLS: High-performance AXI-MM" class="md-nav__link">
      HLS: High-performance AXI-MM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/vivado_tricks/" title="Vivado Tricks" class="md-nav__link">
      Vivado Tricks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      LegoOS-Dev
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        LegoOS-Dev
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1">
    
    <label class="md-nav__link" for="nav-4-1">
      Log
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/misc/" title="MISC" class="md-nav__link">
      MISC
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/test-note/" title="Test Script" class="md-nav__link">
      Test Script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/log-09-2018/" title="Sep 2018" class="md-nav__link">
      Sep 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/log-08-2018/" title="Aug 2018" class="md-nav__link">
      Aug 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/log-04-2018/" title="April 2018" class="md-nav__link">
      April 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/log-03-2018/" title="March 2018" class="md-nav__link">
      March 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/log/log-02-2018/" title="Feb 2018" class="md-nav__link">
      Feb 2018
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2">
    
    <label class="md-nav__link" for="nav-4-2">
      Kernel
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        Kernel
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/kconfig/" title="Kconfig" class="md-nav__link">
      Kconfig
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/grub/" title="GRUB" class="md-nav__link">
      GRUB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile/" title="Profile" class="md-nav__link">
      Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_strace/" title="Profile strace" class="md-nav__link">
      Profile strace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_heatmap/" title="Profile heatmap" class="md-nav__link">
      Profile heatmap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_points/" title="Profile points" class="md-nav__link">
      Profile points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/trampoline/" title="Trampoline" class="md-nav__link">
      Trampoline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/pagefault_disable/" title="Disable pgfault" class="md-nav__link">
      Disable pgfault
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/stop_machine/" title="Stop machine" class="md-nav__link">
      Stop machine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/loader/" title="Program Loader" class="md-nav__link">
      Program Loader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/vDSO/" title="vDSO" class="md-nav__link">
      vDSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/vfs/" title="Virtual File System" class="md-nav__link">
      Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/vm/" title="Process Virtual Memory" class="md-nav__link">
      Process Virtual Memory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/fpu/" title="x86 FPU" class="md-nav__link">
      x86 FPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/irq/" title="IRQ" class="md-nav__link">
      IRQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/net_thpool/" title="Network Thpool" class="md-nav__link">
      Network Thpool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Syscall
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Syscall
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/facts/" title="Facts" class="md-nav__link">
      Facts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_strace/" title="strace" class="md-nav__link">
      strace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/compat/" title="compat" class="md-nav__link">
      compat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/msync/" title="msync()" class="md-nav__link">
      msync()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/mremap/" title="mremap()" class="md-nav__link">
      mremap()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/fork/" title="fork()" class="md-nav__link">
      fork()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/getrusage/" title="getrusage()" class="md-nav__link">
      getrusage()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/wait_and_exit/" title="wait4 and exit()" class="md-nav__link">
      wait4 and exit()
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4">
    
    <label class="md-nav__link" for="nav-4-4">
      Pcache
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        Pcache
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/config/" title="Config" class="md-nav__link">
      Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/sweep/" title="Sweep" class="md-nav__link">
      Sweep
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/tlb/" title="TLB Coherence" class="md-nav__link">
      TLB Coherence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/pgtable-lock/" title="PageTable Lock" class="md-nav__link">
      PageTable Lock
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/victim/" title="Victim Cache" class="md-nav__link">
      Victim Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/virtual_cache/" title="Virtual Cache" class="md-nav__link">
      Virtual Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/rmap/" title="Reverse Mapping" class="md-nav__link">
      Reverse Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/evict_and_ref/" title="Evict and Refcount" class="md-nav__link">
      Evict and Refcount
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/smp_design/" title="SMP Design" class="md-nav__link">
      SMP Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5">
    
    <label class="md-nav__link" for="nav-4-5">
      Driver
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        Driver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/driver/pci/" title="PCI" class="md-nav__link">
      PCI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/driver/ib/" title="Infiniband" class="md-nav__link">
      Infiniband
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6">
    
    <label class="md-nav__link" for="nav-4-6">
      Paper
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        Paper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/nmp/" title="NMP" class="md-nav__link">
      NMP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/processor_oom/" title="Processor OOM" class="md-nav__link">
      Processor OOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/genz/" title="Gen-Z" class="md-nav__link">
      Gen-Z
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/related/" title="Related" class="md-nav__link">
      Related
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nanoseconds" title="Nanoseconds" class="md-nav__link">
    Nanoseconds
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#runahead" title="Runahead" class="md-nav__link">
    Runahead
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#helper-threads-or-precomputation" title="Helper Threads (or Precomputation)" class="md-nav__link">
    Helper Threads (or Precomputation)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-level-speculation" title="Thread-Level Speculation" class="md-nav__link">
    Thread-Level Speculation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#locks" title="Locks" class="md-nav__link">
    Locks
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#misc" title="Misc" class="md-nav__link">
    Misc
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-it-all-together" title="Put it all together" class="md-nav__link">
    Put it all together
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#microseconds" title="Microseconds" class="md-nav__link">
    Microseconds
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#milliseconds" title="Milliseconds" class="md-nav__link">
    Milliseconds
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="hiding-in-the-shadows">Hiding In The Shadows<a class="headerlink" href="#hiding-in-the-shadows" title="Permanent link">&para;</a></h1>
<details class="note"><summary>Version History</summary><table><thead><tr><th align="left">Date</th><th>Description</th></tr></thead><tbody><tr><td align="left">Jul 11, 2019</td><td>Initial draft</td></tr></tbody></table></details><p><img alt="🚦" class="emojione" src="https://cdn.jsdelivr.net/emojione/assets/svg/1f6a6.svg" title=":vertical_traffic_light:" /></p>
<p>There are shadows under the sun.<br />
There are shadows in your life.<br />
There are shadows in your computer.  </p>
<p>This note is about <mark>latency tolerance techniques</mark>.<br />
This note is about how to get the most out of the otherwise-wasted resource.</p>
<h2 id="nanoseconds">Nanoseconds<a class="headerlink" href="#nanoseconds" title="Permanent link">&para;</a></h2>
<p>Architecture solutions to attack nanosecond-level performance shadows
that are mostly created by lower level data and instruction cache misses.
OoO and SMT are the base to hide these latencies, but they fall short
when ROB is full (or some other reasons).
When that happens, these academic ideas come in rescue.</p>
<h3 id="runahead">Runahead<a class="headerlink" href="#runahead" title="Permanent link">&para;</a></h3>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>In runahead, once the processor stalls, it uses the instruction window to
continue to fetch and execute operations. The goal of runahead is to generate
new cache misses, thereby turning subsequent demand requests into cache hits
instead of cache misses.[5]</p>
</div>
<p><strong>Papers</strong></p>
<ol>
<li>Improving Data Cache Performance by Pre-executing Instructions Under a Cache Miss, ICS’97</li>
<li>Runahead Execution: An Alternative to Very Large Instruction Windows for Out-of-order Processors, HPCA’03</li>
<li>Efficient Runahead Execution: Power-Efficient Memory Latency Tolerance, IEEE Micro’06<ul>
<li>Good timeline graphs show the benefit of Runahead.</li>
</ul>
</li>
<li>Runahead Threads to Improve SMT Performance, HPCA’08<ul>
<li>QoS control policy.</li>
</ul>
</li>
<li>Continuous Runahead: Transparent Hardware Acceleration for Memory Intensive Workloads, MICRO’16<ul>
<li>Nice idea to tackle the issue that runahead does not get enough time to run.</li>
<li>Also has the notion of ideal runahead coverage.</li>
</ul>
</li>
</ol>
<p><strong>Comments</strong></p>
<ul>
<li>We should separate mechanism and policy.</li>
<li>Runahead is the mechanism. It includes:<ul>
<li>Enter runahead</li>
<li>Execution in runahead context (most important thing is to maintain those INV bits and pseudo-retires)</li>
<li>Exit runahead</li>
</ul>
</li>
<li>Prefetch is one of the policy, a major one. It&rsquo;s the side effect of running instructions in the execution phase of runahead mode.</li>
<li>QoS control is another policy. This means adding specific rules to the execution phase. More specifically: limit the core resource usage of the runahead thread, thus reduce the impact on the co-running HW thread.</li>
</ul>
<h3 id="helper-threads-or-precomputation">Helper Threads (or Precomputation)<a class="headerlink" href="#helper-threads-or-precomputation" title="Permanent link">&para;</a></h3>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>A helper thread is a stripped down version of the main thread that
only includes the necessary instructions to generate memory accesses,
including control flow instructions [10].</p>
</div>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Precomputation uses idle thread contexts in a multithreaded architecture
to improve performance of single-threaded applications.
It attacks program stalls from data cache misses by
pre-computing future memory accesses in available thread
contexts, and prefetching these data.[1]</p>
</div>
<div class="admonition quote">
<p class="admonition-title">Quote</p>
<p>Such pre-execution threads are
purely speculative, and their instructions are never committed
into the main computation. Instead, the pre-execution
threads run code designed to trigger cache misses. As long
as the pre-execution threads execute far enough in front of
the main thread, they effectively hide the latency of the
cache misses so that the main thread experiences signicantly fewer memory stalls.[5]</p>
</div>
<p><strong>Papers</strong></p>
<ol>
<li>Speculative Precomputation: Long-range Prefetching of Delinquent Loads, ISCA&lsquo;01</li>
<li><em>Dynamic</em> Speculative Precomputation, Micro&lsquo;01<ul>
<li>Take a step further by using HW to construct the offloaded code slice automatically.</li>
</ul>
</li>
<li>Execution-based Prediction Using Speculative Slices, ISCA&lsquo;01</li>
<li>Tolerating Memory Latency through <em>Software-Controlled</em> Pre-Execution in Simultaneous Multithreading Processors, ISCA&lsquo;01<ul>
<li>What&rsquo;s up with ISCA&lsquo;01? This paper proposed to use software to control
when to start running precomputation and when to exit. It uses compiler&rsquo;s
help to generate those code slices, and insert special start/end instructions.
On the contrast, hardware-controller precomputation relies on hints such
as cache misses.</li>
</ul>
</li>
<li>Design and Evaluation of Compiler Algorithms for PreExecution, ASPLOS&lsquo;02<ul>
<li>5.1 A Study of Source-Level Compiler Algorithms for Automatic Construction of Pre-Execution Code, TOCS&lsquo;04</li>
</ul>
</li>
<li>Dynamic Helper Threaded Prefetching on the Sun UltraSPARC® CMP Processor, Micro&lsquo;05<ul>
<li>The <strong>function table</strong> at helper thread seems nice and useful.</li>
</ul>
</li>
<li>Accelerating and Adapting Precomputation Threads for Effcient Prefetching, HPCA&lsquo;07<ul>
<li>Dynamically construct precomputation code, called p-slices. They can adapt
the same program differently depending on the program&rsquo;s data input and the underlying
hardware architecture.</li>
</ul>
</li>
<li>Inter-core Prefetching for Multicore Processors Using <em>Migrating Helper Threads</em>, ASPLOS&lsquo;11<ul>
<li>Pure software solution. I like the idea. But I don&rsquo;t think it will
work for realistic applications.</li>
<li>Learned <code class="codehilite">setcontext(), getcontext(), and swapcontext()</code>.</li>
</ul>
</li>
<li>Bootstrapping: Using SMT Hardware to Improve Single-Thread Performance, ASPLOS&lsquo;19</li>
<li>Freeway: Maximizing MLP for slice-out-of-order execution, HPCA&lsquo;19<ul>
<li>Strictly speaking this is not in this catogory. But it is this paper
  that lead me to Runahead and Helper thread topic. I was doing
  something similar so those techniques caught my eye.</li>
</ul>
</li>
</ol>
<p><strong>Comments</strong></p>
<ul>
<li>The catch about precomputation is that it must create lightweight threads
  that can actually proceed faster than the main thread, so that they
  stay out in front.</li>
<li>Other catch is: you also need to create the code slice that will
  run on another core context. First of all, how is this code slice different
  from the original code? The extracted code will be simplified in the sense
  that it will only access memory without doing other computations.
  The second question is how this code slice is extracted and then constructed?
  There are many ways. You can handwrite, or use a static compiler to pre-generate
  them (by using techniques in above papers), or use hardware to dynamically
  generate them during runtime, or use software to dynamically generate them during runtime.
  There are ways to it, but I don&rsquo;t think this is the core of precomputation.</li>
<li>Also, same thing here, we should separate mechanism and policies.
  Helper thread (or precomputation) is mainly used as a vehicle
  for speculatively generating data addresses and prefetching.</li>
</ul>
<h3 id="thread-level-speculation">Thread-Level Speculation<a class="headerlink" href="#thread-level-speculation" title="Permanent link">&para;</a></h3>
<p>Fill me in.</p>
<h3 id="locks">Locks<a class="headerlink" href="#locks" title="Permanent link">&para;</a></h3>
<p>Applying the insight of &ldquo;get the most out of the otherwise-wasted resource&rdquo;
to the lock area. I will wait for Sanidhya&rsquo;s SOSP&lsquo;19 paper. :-)</p>
<h3 id="misc">Misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h3>
<ul>
<li>Stretch: Balancing QoS and throughput for colocated server workloads on SMT cores (Best Paper), HPCA&lsquo;19<ul>
<li>Keyword: <code class="codehilite">ROB</code>, <code class="codehilite">Co-location QoS</code>.</li>
<li>This paper tackles the perf interference when running co-running two SMT threads
  on a single physical core, which is the common case in datacenters.
  However co-running latency-sensitive jobs and batch jobs will
  have huge impact on the perf of both.</li>
<li>This paper found: <em>&ldquo;Latency-sensitive workloads show little benefit
  from large ROB capacities in modern server processors .. because frequent
  cache misses and data-dependent computation limit both instruction
  and memory-level parallelisms (ILP and MLP). In contrast, many batch
  workloads benefit from a large ROB that helps unlock higher ILP and MLP.&rdquo;</em></li>
<li>So they propose to have a ROB partition scheme rather than static equal
  partition. Of course they also did some very extensive studies before
  deciding to scale ROB. They first found shared ROB has the biggest
  impact on perf interference than any other resources such as branch
  predictor, cache, and so on. They further found that latency-sensitive
  workload can tolerate some perf slack, which means they will not
  violate their QoS even with a smaller ROB.</li>
<li>Anyway, I think this is a very nice paper. Good reasoning, simple solution,
  but works effectively.</li>
</ul>
</li>
</ul>
<h3 id="put-it-all-together">Put it all together<a class="headerlink" href="#put-it-all-together" title="Permanent link">&para;</a></h3>
<ul>
<li>Both runahead and helper thread were proposed to do prefetch.
  But they have a key difference. Runahead is invoked in the <em>same core</em>,
  and is invoked when ROB is full (not always though). Helper thread is
  invoked at <em>another core</em>. Besides, runahead can just fetch the
  instructions and run, no need to cook another code slice. But for
  helper thread, it needs to extract a code slice that will run on another core.</li>
<li>I think the most important thing is to realize their insight.
  In the most straightforward and plain way: they are trying to
  get the most out of the otherwise-wasted resource. For example,
  in runahead, they realize that with some help, the CPU is still
  able to generate cache misses even if the instruction table is full.
  For precomputation, obviously it is using the other idle cores.
  The simple insight itself is not interesting enough, usually
  where it&rsquo;s applied make things quite interesting.</li>
</ul>
<h2 id="microseconds">Microseconds<a class="headerlink" href="#microseconds" title="Permanent link">&para;</a></h2>
<p>Fill me in</p>
<h2 id="milliseconds">Milliseconds<a class="headerlink" href="#milliseconds" title="Permanent link">&para;</a></h2>
<p>Sleep. And wake me up when september ends. And this seems to be enough. ;-)
This is true for OS to handle slow HDD and slow network.</p>
                
                  
                
              
              
                
                  


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://lastweek.io/notes/paper_perf_shadows/";
      this.page.identifier =
        "/notes/paper_perf_shadows/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//lastweek-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../benchmark/" title="Benchmarks" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Benchmarks
              </span>
            </div>
          </a>
        
        
          <a href="../cache_coherence/" title="Cache Coherence" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Cache Coherence
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/lastweek" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.abd7b172.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-143772066-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>