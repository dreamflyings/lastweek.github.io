



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="http://lastweek.io/notes/source_code/">
      
      
        <meta name="author" content="Yizhou Shan">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.2">
    
    
      
        <title>Open-Source-Code-Study - Yizhou Shan's Home Page</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.9b572555.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,700|">
        <style>body,input{font-family:"Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#source-code-study" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://lastweek.io" title="Yizhou Shan's Home Page" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Yizhou Shan's Home Page
              </span>
              <span class="md-header-nav__topic">
                Open-Source-Code-Study
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Yizhou Shan's Home Page
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Blog
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Blog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../blog/20200404-on-net-transport/" title="2020-04 On Hardware-based Network Transport" class="md-nav__link">
      2020-04 On Hardware-based Network Transport
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Notes
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Notes
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Open-Source-Code-Study
      </label>
    
    <a href="./" title="Open-Source-Code-Study" class="md-nav__link md-nav__link--active">
      Open-Source-Code-Study
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#misc" title="Misc" class="md-nav__link">
    Misc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-systems" title="Operating Systems" class="md-nav__link">
    Operating Systems
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtualization" title="Virtualization" class="md-nav__link">
    Virtualization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilers" title="Compilers" class="md-nav__link">
    Compilers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firmware" title="Firmware" class="md-nav__link">
    Firmware
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fpga" title="FPGA" class="md-nav__link">
    FPGA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-servers" title="Web Servers" class="md-nav__link">
    Web Servers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-value-stores" title="Key Value Stores" class="md-nav__link">
    Key Value Stores
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases" title="Databases" class="md-nav__link">
    Databases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rdma-and-more" title="RDMA and More" class="md-nav__link">
    RDMA and More
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../program_advice/" title="Programming-Guidelines-and-Advice" class="md-nav__link">
      Programming-Guidelines-and-Advice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../virt/" title="Virtualization-Software" class="md-nav__link">
      Virtualization-Software
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cache_coherence/" title="Practical-Cache-Coherence" class="md-nav__link">
      Practical-Cache-Coherence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../xperf/" title="Measure-x86-Ring-Switch-Overhead" class="md-nav__link">
      Measure-x86-Ring-Switch-Overhead
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../paper_perf_shadows/" title="Performance-Shadows" class="md-nav__link">
      Performance-Shadows
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rmap/" title="Linux Reverse Map (rmap)" class="md-nav__link">
      Linux Reverse Map (rmap)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../userfaultfd/" title="Linux Userfaultfd" class="md-nav__link">
      Linux Userfaultfd
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../trace/" title="Linux Trace/Profile" class="md-nav__link">
      Linux Trace/Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cgroup-swap/" title="Linux Cgroup and Swap" class="md-nav__link">
      Linux Cgroup and Swap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../proc/" title="Linux Special Files" class="md-nav__link">
      Linux Special Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../linux-resource/" title="Linux Resource" class="md-nav__link">
      Linux Resource
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kvm-basic/" title="Linux KVM" class="md-nav__link">
      Linux KVM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/essential/" title="Essential" class="md-nav__link">
      Essential
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../benchmark/" title="Benchmarks" class="md-nav__link">
      Benchmarks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../misc/cheatsheet/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      FPGA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        FPGA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../paper_fpga/" title="Papers" class="md-nav__link">
      Papers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/bitstream/" title="Bitstream Explained" class="md-nav__link">
      Bitstream Explained
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/pr/" title="Morphous PR" class="md-nav__link">
      Morphous PR
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/vivado/" title="Vivado Practice" class="md-nav__link">
      Vivado Practice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fpga/hls_axi/" title="Efficient AXI-MM" class="md-nav__link">
      Efficient AXI-MM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      LegoOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        LegoOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-1" type="checkbox" id="nav-5-1">
    
    <label class="md-nav__link" for="nav-5-1">
      Kernel
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-1">
        Kernel
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/boot/" title="GRUB2 and Boot" class="md-nav__link">
      GRUB2 and Boot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/kconfig/" title="Kconfig" class="md-nav__link">
      Kconfig
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/grub/" title="GRUB" class="md-nav__link">
      GRUB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile/" title="Profile" class="md-nav__link">
      Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_strace/" title="Profile strace" class="md-nav__link">
      Profile strace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_heatmap/" title="Profile heatmap" class="md-nav__link">
      Profile heatmap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_points/" title="Profile points" class="md-nav__link">
      Profile points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/trampoline/" title="Trampoline" class="md-nav__link">
      Trampoline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/pagefault_disable/" title="Disable pgfault" class="md-nav__link">
      Disable pgfault
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/stop_machine/" title="Stop machine" class="md-nav__link">
      Stop machine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/loader/" title="Program Loader" class="md-nav__link">
      Program Loader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/vDSO/" title="vDSO" class="md-nav__link">
      vDSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/vfs/" title="Virtual File System" class="md-nav__link">
      Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/vm/" title="Process Virtual Memory" class="md-nav__link">
      Process Virtual Memory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/fpu/" title="x86 FPU" class="md-nav__link">
      x86 FPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/irq/" title="IRQ" class="md-nav__link">
      IRQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/net_thpool/" title="Network Thpool" class="md-nav__link">
      Network Thpool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Syscall
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        Syscall
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/facts/" title="Facts" class="md-nav__link">
      Facts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/kernel/profile_strace/" title="strace" class="md-nav__link">
      strace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/compat/" title="compat" class="md-nav__link">
      compat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/msync/" title="msync()" class="md-nav__link">
      msync()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/mremap/" title="mremap()" class="md-nav__link">
      mremap()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/fork/" title="fork()" class="md-nav__link">
      fork()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/getrusage/" title="getrusage()" class="md-nav__link">
      getrusage()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/syscall/wait_and_exit/" title="wait4 and exit()" class="md-nav__link">
      wait4 and exit()
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Pcache
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        Pcache
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/config/" title="Config" class="md-nav__link">
      Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/sweep/" title="Sweep" class="md-nav__link">
      Sweep
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/tlb/" title="TLB Coherence" class="md-nav__link">
      TLB Coherence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/pgtable-lock/" title="PageTable Lock" class="md-nav__link">
      PageTable Lock
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/victim/" title="Victim Cache" class="md-nav__link">
      Victim Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/virtual_cache/" title="Virtual Cache" class="md-nav__link">
      Virtual Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/rmap/" title="Reverse Mapping" class="md-nav__link">
      Reverse Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/evict_and_ref/" title="Evict and Refcount" class="md-nav__link">
      Evict and Refcount
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/smp_design/" title="SMP Design" class="md-nav__link">
      SMP Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/pcache/replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4">
    
    <label class="md-nav__link" for="nav-5-4">
      Driver
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        Driver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/driver/pci/" title="PCI" class="md-nav__link">
      PCI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/driver/ib/" title="Infiniband" class="md-nav__link">
      Infiniband
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5">
    
    <label class="md-nav__link" for="nav-5-5">
      Paper
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        Paper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/nmp/" title="NMP" class="md-nav__link">
      NMP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/processor_oom/" title="Processor OOM" class="md-nav__link">
      Processor OOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/genz/" title="Gen-Z" class="md-nav__link">
      Gen-Z
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../lego/paper/related/" title="Related" class="md-nav__link">
      Related
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#misc" title="Misc" class="md-nav__link">
    Misc
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-systems" title="Operating Systems" class="md-nav__link">
    Operating Systems
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtualization" title="Virtualization" class="md-nav__link">
    Virtualization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilers" title="Compilers" class="md-nav__link">
    Compilers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#firmware" title="Firmware" class="md-nav__link">
    Firmware
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fpga" title="FPGA" class="md-nav__link">
    FPGA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-servers" title="Web Servers" class="md-nav__link">
    Web Servers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-value-stores" title="Key Value Stores" class="md-nav__link">
    Key Value Stores
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases" title="Databases" class="md-nav__link">
    Databases
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rdma-and-more" title="RDMA and More" class="md-nav__link">
    RDMA and More
  </a>
  
</li>
      
      
      
      
      
        <li class="md-nav__item">
          <a href="#__comments" title="Comments" class="md-nav__link md-nav__link--active">
            Comments
          </a>
        </li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="source-code-study">Source Code Study<a class="headerlink" href="#source-code-study" title="Permanent link">&para;</a></h1>
<details class="note"><summary>Version History</summary><table><thead><tr><th align="left">Date</th><th>Description</th></tr></thead><tbody><tr><td align="left">Apr 10, 2020</td><td>add graphics section</td></tr><tr><td align="left">Apr 6, 2020</td><td>add verbs perftes</td></tr><tr><td align="left">Mar 3, 2020</td><td>add FreeBSD, some fpga stuff</td></tr><tr><td align="left">Feb 4, 2020</td><td>add io_uring, firecracker</td></tr><tr><td align="left">Jan 31, 2020</td><td>Add some good stuff</td></tr><tr><td align="left">Jan 18, 2020</td><td>Initial</td></tr></tbody></table></details><p>Beautiful code is art.
Recently I started forking good open source code
into my own Github account and started casual reading and taking notes.
This page links to all of them.</p>
<p>Happy hacking!</p>
<h2 id="misc">Misc<a class="headerlink" href="#misc" title="Permanent link">&para;</a></h2>
<p>Projects supporting our day-to-day work.</p>
<ul>
<li><a href="https://github.com/lastweek/source-glibc">glibc: libc, elf, and dynamic linker</a><ul>
<li>Some juicy information about GOT/PLT</li>
<li>and explains what has happend before main() is called</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-binutils">binutils: gas, static linker, and more</a><ul>
<li>assembler is amazing</li>
<li>static linker.. the magic thing is its linker script!</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-strace">strace</a><ul>
<li>System call tracer at userspace</li>
<li>I&rsquo;ve designed <a href="http://lastweek.io/lego/kernel/profile_strace/">one</a> for LegoOS in kernel space</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-vim">vim</a></li>
<li><a href="https://github.com/lastweek/source-tmux">tmux</a></li>
<li><a href="https://github.com/lastweek/source-git">git</a></li>
<li>Network<ul>
<li><a href="https://github.com/lastweek/source-iperf">iperf3</a> is a TCP, UDP, and SCTP network bandwidth measurement tool</li>
<li><a href="https://github.com/lastweek/source-tcpdump">tcpdump</a></li>
<li><a href="https://github.com/lastweek/source-openssh-portable">OpenSSH</a> is our ssh!</li>
<li><a href="https://github.com/lastweek/source-scapy">scapy</a><ul>
<li>Python-based interactive packet manipulation program &amp; library</li>
<li>Very neat</li>
</ul>
</li>
</ul>
</li>
<li>Graphics<ul>
<li><a href="https://github.com/neutrinolabs/xrdp">xRDP, an RDP server. In C</a></li>
<li><a href="https://github.com/FreeRDP/FreeRDP">FreeRDP, client and server. In C</a><ul>
<li>Took a brief read of the code, it&rsquo;s super neat. Should take a serious look sometime.</li>
</ul>
</li>
</ul>
</li>
<li>C for life<ul>
<li><a href="https://github.com/lastweek/source-cJSON">cJSON</a><ul>
<li>A lightweight JSON parser in C.</li>
<li>I think iperf3 is using it.</li>
</ul>
</li>
</ul>
</li>
<li>Outliers<ul>
<li><a href="https://github.com/lastweek/source-criu">CRIU: Checkpoint and Restore in Userspace</a><ul>
<li>The reason I love this repo is because it has so many interesting pieces
  on how to interact with kernel, save states, and restore them. In addition,
  it shows how to properly use many less well known syscalls.</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-grub2">GRUB2: bootloader</a><ul>
<li>Learn how modern bootloader works.</li>
<li>Detailed analysis of Linux booting sequence (how it transit from
  real-mode to protected mode, and finally to 64-bit mode,
  how to navigate Linux source code etc.)</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-FFmpeg">FFmpeg</a><ul>
<li>FFmpeg project is famous for its clean and neat C code.</li>
<li>Besides, this project is used by a lot online video service companies</li>
</ul>
</li>
<li><a href="https://kernel.dk/io_uring.pdf"><code class="codehilite">io_uring</code></a><ul>
<li><a href="https://github.com/axboe/liburing">user liburing</a></li>
<li><a href="https://github.com/torvalds/linux/blob/master/fs/io_uring.c">kernel io_uring.c</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="operating-systems">Operating Systems<a class="headerlink" href="#operating-systems" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/linux-0.01">Linux 0.0.1</a></li>
<li><a href="https://github.com/lastweek/source-plan9">Plan 9 OS</a></li>
<li><a href="https://github.com/lastweek/source-singularity">MSR Singularity.</a></li>
<li><a href="https://github.com/lastweek/source-illumos-gate">illumos</a>
        - This is a fork of Oracle Solaris OS.</li>
<li><a href="https://github.com/lastweek/source-seL4">seL4 Microkernel</a></li>
<li><a href="https://github.com/lastweek/source-darwin-xnu">MacOS Darwin</a></li>
<li>BSD: these repos have everything you can think of<ul>
<li>If you ever wondered how X is done, how to get Y from OS, this is where you look into.</li>
<li><a href="https://github.com/lastweek/source-freebsd">FreeBSD</a></li>
<li><a href="https://github.com/openbsd/src">OpenBSD</a></li>
<li><a href="https://github.com/NetBSD/src">NetBSD</a></li>
<li><a href="https://github.com/trueos/trueos">TrueOS</a></li>
</ul>
</li>
<li><a href="http://unikernel.org/">Unikernel</a><ul>
<li><a href="https://github.com/lastweek/source-osv">OSv. A lightweight unikernel.</a></li>
<li><a href="https://github.com/lastweek/source-IncludeOS">IncludeOS</a></li>
<li><a href="https://github.com/lastweek/source-rumprun">Rumprun</a></li>
<li><a href="https://github.com/lastweek/source-solo5">Solo5. Unikernel as processes!</a></li>
</ul>
</li>
</ul>
<p><img alt="image_unix_timeline" src="../../images/unix_timeline.png" />
(Image source: <a href="https://commons.wikimedia.org/wiki/File:Unix_timeline.en.svg">https://commons.wikimedia.org/wiki/File:Unix_timeline.en.svg</a>)</p>
<h2 id="virtualization">Virtualization<a class="headerlink" href="#virtualization" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/source-libvirt">libvirt: virsh and more</a></li>
<li><a href="https://github.com/lastweek/source-qemu">QEMU</a><ul>
<li>Check my <a href="http://lastweek.io/notes/virt/">notes</a></li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-firecracker">Firecracker</a></li>
<li><a href="https://github.com/rust-vmm/community">rust-vmm</a></li>
<li><a href="https://github.com/cloud-hypervisor/cloud-hypervisor">cloud-hypervisor</a></li>
</ul>
<h2 id="compilers">Compilers<a class="headerlink" href="#compilers" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/source-rust">Rustc, in Rust</a></li>
<li><a href="https://github.com/lastweek/source-php-src">PHP, in C</a></li>
<li><a href="https://github.com/lastweek/source-cpython">Python, in C</a></li>
<li><a href="https://github.com/lastweek/v8">Google V8, in C++</a></li>
<li><a href="https://github.com/lastweek/source-swift">Apple Swift, in C++</a></li>
<li><a href="https://github.com/gcc-mirror/gcc">GNU GCC</a></li>
<li><a href="https://github.com/lastweek/source-tcl">TCL, in C</a></li>
<li><a href="https://github.com/lastweek/source-perl5">Perl 5, in C</a></li>
</ul>
<h2 id="firmware">Firmware<a class="headerlink" href="#firmware" title="Permanent link">&para;</a></h2>
<p>I&rsquo;m obsessed with firmware projects, maybe because that&rsquo;s where I got started.
First it&rsquo;s SeaBIOS, the default one used by QEMU. Then UEFI, something I have never used (!).</p>
<ul>
<li><a href="https://github.com/lastweek/source-firmware-seabios">SeaBIOS: the default BIOS used by QEMU</a></li>
<li><a href="https://github.com/lastweek/source-firmware-qboot">qboot: an alternative and lightweight BIOS for QEMU</a><ul>
<li>Those are massive hackers, respect.</li>
<li>My experience about BIOS is calling them while the kernel (LegoOS) is running at 16-bit.
  BIOS <em>is</em> the OS for a just-booted kernel. I remember the lower 1MB is never cleared,
  maybe we could invoke the BIOS at 32 or 64-bit mode?</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-uefi-edk2">UEFI EDK II </a><ul>
<li>&ldquo;EDK II is a firmware development environment for the UEFI and UEFI Platform Initialization (PI) specifications&rdquo;</li>
<li>Part of the <a href="https://www.tianocore.org/">TianoCore</a> project, an open-source UEFI platform</li>
<li>The Unified Extensible Firmware Interface (UEFI) is a specification that
  defines a software interface between an operating system and platform firmware.
  UEFI is designed to replace the Basic Input/Output System (BIOS) firmware interface.</li>
<li><a href="https://github.com/tianocore/tianocore.github.io/wiki/OVMF">OVMF</a>: OVMF is an EDK II based project to enable UEFI support for Virtual Machines. OVMF contains sample UEFI firmware for QEMU and KVM.</li>
</ul>
</li>
<li><a href="https://microsoft.github.io/mu/">Microsoft Project Mu, a separate fork of EDK II</a><ul>
<li>&ldquo;Project Mu is a modular adaptation of TianoCore&rsquo;s edk2 tuned for building
modern devices using a scalable, maintainable, and reusable pattern&rdquo;</li>
<li>It&rsquo;s homepage explains the motivation behind it.</li>
</ul>
</li>
<li>A book: <code class="codehilite">Beyond BIOS Developing with the Unified Extensible Firmware Interface</code>.</li>
</ul>
<h2 id="fpga">FPGA<a class="headerlink" href="#fpga" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/fpga_vivado_scripts">My own Collection</a></li>
<li><a href="https://github.com/lastweek/fpga_readings">My own Paper Readings</a></li>
<li>Partial Reconfiguration<ul>
<li><a href="https://github.com/lastweek/fpga_pr_scripts">Partial Reconfiguration Building Framework</a></li>
<li><a href="https://github.com/lastweek/fpga_interpret_bitstream">Intepret Xilinx Bitstream</a></li>
<li><a href="https://github.com/lastweek/fpga_icap_hls/">HLS-based <strong>ICAP</strong> Controller</a></li>
</ul>
</li>
<li>Network<ul>
<li><a href="https://github.com/ucsdsysnet/corundum">Corundum: an FPGA-based NIC</a><ul>
<li>This is THE BEST network stack out there.</li>
<li>This is not simply a network stack, it is a NIC.</li>
<li>So what makes a NIC? First, PHY and MAC are basic.
Second, PCIe connection between host and board.
Third, DMA using PCIe, for TX and RX packets between host and board.
Fourth, a host NIC driver;
Fifth, some opt modules at NIC.</li>
<li>This project has it all. Most amazingly, it works on so many boards.</li>
<li>They have an FCCM&lsquo;20 paper (finally!) describing the small modules inside.</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-verilog-ethernet">Verilog-Ethernet</a><ul>
<li>Self-made PHY, MAC IPs, ARP, IP, UDP stack</li>
<li>This is also used by the Corundum project.</li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-Limago">Limago, HLS-based 100 GbE TCP/IP</a></li>
<li><a href="https://github.com/fpgasystems/fpga-network-stack">FPGA Network Stack</a><ul>
<li>This one came from ETH as well.</li>
<li>This one is used by many papers, as far as i know, StRoM, EuroSys&lsquo;20.</li>
<li>It&rsquo;s mostly HLS-based. And has ETH/IP/UDP/TCP, RoCE v2 stack.</li>
</ul>
</li>
</ul>
</li>
<li>Simulation, Synthesis, and P&amp;R<ul>
<li><a href="https://github.com/lastweek/source-iverilog">Icarus iverilog</a>.
  iverilog is a compiler that translates Verilog source code into
  executable programs for simulation, or other netlist formats for further processing <a href="https://linux.die.net/man/1/iverilog">man page</a>.</li>
<li><a href="https://github.com/lastweek/source-cascade">VMware Cascade</a>.
  Just-in-time compilation for Verilog, what a brilliant idea.</li>
<li><a href="https://github.com/lastweek/source-vtr-verilog-to-routing">Verilog-to-routing</a>.<ul>
<li>Synthesis (<code class="codehilite">ODIN II</code>)</li>
<li>Logic Optimization &amp; Technology Mapping (<code class="codehilite">ABC</code>)</li>
<li>Placement and Route (<code class="codehilite">VPR</code>)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="web-servers">Web Servers<a class="headerlink" href="#web-servers" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/source-httpd">Apache httpd</a></li>
<li><a href="https://github.com/lastweek/source-nginx">nginx</a></li>
</ul>
<h2 id="key-value-stores">Key Value Stores<a class="headerlink" href="#key-value-stores" title="Permanent link">&para;</a></h2>
<p>Point of interests:
1) in-memory, and can it extend to use disk/ssd?
2) persistence support
3) network support</p>
<ul>
<li><a href="https://github.com/lastweek/source-rocksdb">RocksDB: A persistent KVS for Flash and RAM Storage. C++</a></li>
<li><a href="https://github.com/lastweek/source-leveldb">LevelDB. C++</a></li>
<li><a href="https://github.com/lastweek/source-memcached">Memcached. C</a></li>
<li><a href="https://github.com/lastweek/source-redis">Redis. C</a></li>
<li><a href="https://github.com/lastweek/source-etcd">etcd: Distributed reliable KVS. Go</a></li>
</ul>
<h2 id="databases">Databases<a class="headerlink" href="#databases" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/source-mysql-server">MySQL</a></li>
<li><a href="https://github.com/lastweek/source-postgres">PostgresSQL</a></li>
<li><a href="https://github.com/lastweek/yugabyte-db">Yugabyte, distributed SQL</a></li>
</ul>
<h2 id="rdma-and-more">RDMA and More<a class="headerlink" href="#rdma-and-more" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://github.com/lastweek/source-libvma">Mellanox libvma</a></li>
<li><a href="https://github.com/lastweek/source-verbs-perftest">verbs perftest</a><ul>
<li>The collection contains a set of bandwidth and latency benchmark such as:</li>
<li>Send        - ib_send_bw and ib_send_lat</li>
<li>RDMA Read   - ib_read_bw and ib_read_lat</li>
<li>RDMA Write  - ib_write_bw and ib_wriet_lat</li>
<li>RDMA Atomic - ib_atomic_bw and ib_atomic_lat</li>
<li>Native Ethernet (when working with MOFED2) - raw_ethernet_bw, raw_ethernet_lat </li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-rdma-core">rdma-core</a><ul>
<li>Userspace IB verbs library (e.g., libibverbs)</li>
<li>Learn how userspace IB layer communicate with kernel, but also bypass kernel.
  The technique replies on <code class="codehilite">ioctl()</code> and <code class="codehilite">mmap()</code>, standard.
  But the ABI interface (i.e., data structures) are quite complex.</li>
<li><code class="codehilite">libibverbs/example</code><ul>
<li>asyncwatch.c</li>
<li>device_list.c</li>
<li>devinfo.c</li>
<li>pingpong.c</li>
<li>rc_pingpong.c</li>
<li>srq_pingpong.c</li>
<li>uc_pingpong.c</li>
<li>ud_pingpong.c</li>
<li>xsrq_pingpong.c</li>
</ul>
</li>
<li><code class="codehilite">infiniband-diags</code><ul>
<li>ibv_devinfo    </li>
<li>iblinkinfo    </li>
<li>ibping    </li>
<li>ibaddr</li>
</ul>
</li>
<li><a href="https://github.com/torvalds/linux/tree/master/drivers/infiniband">Kernel Infiniband stack</a></li>
</ul>
</li>
<li><a href="https://github.com/lastweek/source-dpdk">DPDK</a><ul>
<li>DPDK uses VFIO to directly access physical device.
Just like how we directly assign device to guest OS in QEMU.</li>
<li>Even though both DPDK and RDMA bypass kernel, their control
path is very different. For DPDK, there is a complete device
driver in the user space, and this driver communicate with the device via MMIO.
After VFIO ioctls, all data and control path bypass kernel.
For rdma-core, a lot control-path IB verbs (e.g., create_pd, create_cq) communicate with kernel via Infiniband device file ioctl.
And you can see all those uverb hanlders in <code class="codehilite">drivers/infiniband/core/uverbs.c</code>
Those control verbs will mmap some pages between user and kernel,
so all following datapath IB verbs (e.g., post_send) will just bypass kernel
and talk to device MMIO directly. Although rdma-core also has some vendor-specific
&ldquo;drivers&rdquo;, but this is really different from the above DPDK&rsquo;s userspace PCIe driver, per se.
Userspace &ldquo;rdma-core&rdquo; vendor-driver deals with the kernel devel vendor-level driver details.</li>
<li>FWIW, if you are using a Mellanox VPI card in Ethernet mode (e.g. CX3-5),
  DPDK will use its built-in mlx driver, which further use libibverbs,
  which further relies on kernel IB stack. It&rsquo;s not a complete user solution somehow.
  Note that DPDK built-in mlx driver uses RAW_PACKET QPs.</li>
<li><img alt="image" src="../../images/dpdk_ibverbs.png" /></li>
</ul>
</li>
</ul>
                
                  
                
              
              
                
                  


  <h2 id="__comments">Comments</h2>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = "http://lastweek.io/notes/source_code/";
      this.page.identifier =
        "/notes/source_code/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//lastweek-io.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>

                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../blog/20200404-on-net-transport/" title="2020-04 On Hardware-based Network Transport" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                2020-04 On Hardware-based Network Transport
              </span>
            </div>
          </a>
        
        
          <a href="../program_advice/" title="Programming-Guidelines-and-Advice" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Programming-Guidelines-and-Advice
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/lastweek" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://twitter.com/Yizhou_Shan" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/in/lastweek/" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.abd7b172.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../.."}})</script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-143772066-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>