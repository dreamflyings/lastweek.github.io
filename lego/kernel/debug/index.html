<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Yizhou Shan">
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Debug - Yizhou Shan's Home Page</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Debug";
    var mkdocs_page_input_path = "lego/kernel/debug.md";
    var mkdocs_page_url = "/lego/kernel/debug/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-143772066-1', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Yizhou Shan's Home Page</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="tocbase current">
    
    
      


  <li class="navtree toctree-l1 inactive">
    <a class="" href="../../..">Home</a>
  </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Notes</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/paper_fpga/">FPGA Papers</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/cache_coherence/">Cache Coherence</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/benchmark/">Benchmarks</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/paper_perf_shadows/">Perf Shadows</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/linux-articles/">Linux Articles</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/proc/">[Linux] Special Files</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/rmap/">[Linux] Reverse Mmap (rmap)</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/trace/">[Linux] Trace/Profile</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/cgroup-swap/">[Linux] Cgroup and Swap</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/userfaultfd/">[Linux] Userfaultfd</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/xperf/">[Linux] User/kern Cross Perf</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../notes/kvm-basic/">[Linux] KVM</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../misc/essential/">Essential</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../misc/cheatsheet/">Cheatsheet</a>
  </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Log</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../../general_log/0919/">Sep 2019</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../../general_log/0819/">Aug 2019</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../../general_log/0719/">Jul 2019</a>
  </li>
        
      </ul>
    </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">FPGA</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../fpga/hls_axi/">HLS: Usage of AXI-Stream</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../fpga/hls_axi/">HLS: High-performance AXI-MM</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../../../fpga/vivado_tricks/">Vivado Tricks</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">LegoOS-Dev</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Log</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/TODO/">TODO</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/misc/">MISC</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/test-note/">Test Script</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/log-09-2018/">Sep 2018</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/log-08-2018/">Aug 2018</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/log-04-2018/">April 2018</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/log-03-2018/">March 2018</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../log/log-02-2018/">Feb 2018</a>
  </li>
        
      </ul>
    </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Kernel</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../kconfig/">Kconfig</a>
  </li>
        
          


  
    
    <li class="navtree toctree-l3 page current">
      <a class="current" href="./">
        Debug
      </a>
    </li>
    
      

  <li class="toctree-l3 current with-children">
    <a href="#debug-facility-in-lego">
      Debug Facility in Lego
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3 current">
    <ul class="subnav-l3 current">
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#core-kernel">Core Kernel</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#processor-manager">Processor Manager</a>
        </li>
    
      
        <li class="toctree-l4">
          <a class="toctree-l5" href="#memory-manager">Memory Manager</a>
        </li>
    
    </ul>
  </li>


  
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../grub/">GRUB</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../profile/">Profile</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../profile_strace/">Profile strace</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../profile_heatmap/">Profile heatmap</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../profile_points/">Profile points</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../trampoline/">Trampoline</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../pagefault_disable/">Disable pgfault</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../stop_machine/">Stop machine</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../loader/">Program Loader</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../vDSO/">vDSO</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../vfs/">Virtual File System</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../vm/">Process Virtual Memory</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../fpu/">x86 FPU</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../irq/">IRQ</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../net_thpool/">Network Thpool</a>
  </li>
        
      </ul>
    </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Syscall</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/facts/">Facts</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../profile_strace/">strace</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/compat/">compat</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/msync/">msync()</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/mremap/">mremap()</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/fork/">fork()</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/getrusage/">getrusage()</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../syscall/wait_and_exit/">wait4 and exit()</a>
  </li>
        
      </ul>
    </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Pcache</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/config/">Config</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/sweep/">Sweep</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/tlb/">TLB Coherence</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/pgtable-lock/">PageTable Lock</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/victim/">Victim Cache</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/virtual_cache/">Virtual Cache</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/rmap/">Reverse Mapping</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/evict_and_ref/">Evict and Refcount</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/smp_design/">SMP Design</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../pcache/replication/">Replication</a>
  </li>
        
      </ul>
    </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Driver</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../driver/pci/">PCI</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../driver/ib/">Infiniband</a>
  </li>
        
      </ul>
    </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Paper</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../paper/nmp/">NMP</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../paper/processor_oom/">Processor OOM</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../paper/genz/">Gen-Z</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../paper/replication/">Replication</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../../paper/related/">Related</a>
  </li>
        
      </ul>
    </li>
        
      </ul>
    </li>
    
  </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Yizhou Shan's Home Page</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Kernel &raquo;</li>
        
      
        
          <li>LegoOS-Dev &raquo;</li>
        
      
    
    <li>Debug</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="debug-facility-in-lego">Debug Facility in Lego<a class="headerlink" href="#debug-facility-in-lego" title="Permanent link">&para;</a></h1>
<p>Lego provides several handy debug helpers to ease our coding pain. We category them by layers, namely <strong>1)</strong> <code class="codehilite"><span class="n">Core</span> <span class="n">Kernel</span></code>, the lowest level of Lego, which is shared by all managers. <strong>2)</strong> <code class="codehilite"><span class="n">Processor</span> <span class="n">Manager</span></code>, which controls processor components. <strong>3)</strong> <code class="codehilite"><span class="n">Memory</span> <span class="n">Manager</span></code>, which controls memory components.</p>
<h2 id="core-kernel">Core Kernel<a class="headerlink" href="#core-kernel" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">dump_pte</span><span class="p">(</span><span class="n">pte_t</span> <span class="o">*</span><span class="n">ptep</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reason</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">dump_page</span><span class="p">(</span><span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">page</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reason</span><span class="p">);</span>
</pre></div>
</td></tr></table>
These two helpers will dump a given pte entry or a page. Use this function if you are developing core related to physical memory allocation or pcache.</p>
<hr />
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">ptdump_walk_pgd_level</span><span class="p">(</span><span class="n">pgd_t</span> <span class="o">*</span><span class="n">pgd</span><span class="p">);</span>
</pre></div>
</td></tr></table>
This debug helper will dump the whole pgtable ranges. Contiguous page table entries that share the same property will be merged together and will be printed once. Use this function if you are developing code related to user page tables.</p>
<hr />
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">show_state_filter</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">state_filter</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">print_rq</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">sched_show_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">sysrq_sched_debug_show</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</td></tr></table>
This set of functions are debug helpers for local scheduler. They will print all the tasks running in the system, and detailed information about percpu <code class="codehilite"><span class="n">runqueue</span></code>. Use this set of functions if you are developing code related to scheduler.</p>
<h2 id="processor-manager">Processor Manager<a class="headerlink" href="#processor-manager" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">dump_pcache_meta</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcache_meta</span> <span class="o">*</span><span class="n">pcm</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reason</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">dump_pcache_victim</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcache_victim_meta</span> <span class="o">*</span><span class="n">victim</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reason</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">dump_pcache_rmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcache_rmap</span> <span class="o">*</span><span class="n">rmap</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reason</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">dump_pcache_line</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcache_meta</span> <span class="o">*</span><span class="n">pcm</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">reason</span><span class="p">);</span>
</pre></div>
</td></tr></table>
These functions dump a given pcache line, a victim line, or a given reserve mapping. The last one will print the pcache line content, which generates a lot messages, you are warned. Use these functions if you are developing pcache or victim cache code.</p>
<h2 id="memory-manager">Memory Manager<a class="headerlink" href="#memory-manager" title="Permanent link">&para;</a></h2>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">dump_lego_mm</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">lego_mm_struct</span> <span class="o">*</span><span class="n">mm</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">dump_vma</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">);</span>
</pre></div>
</td></tr></table>
These two functions are used to dump the virtual address space of a process. Use these functions if you developing process VM related things.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../grub/" class="btn btn-neutral float-right" title="GRUB">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../kconfig/" class="btn btn-neutral" title="Kconfig"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../kconfig/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../grub/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
