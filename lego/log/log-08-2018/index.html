



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.2, mkdocs-material-2.6.2">
    
    
      
        <title>Aug 2018 - Yizhou Shan's Home Page</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/application.9b572555.css">
      
    
    
      <script src="../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#aug-2018" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../.." title="Yizhou Shan's Home Page" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Yizhou Shan's Home Page
              </span>
              <span class="md-header-nav__topic">
                Aug 2018
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Yizhou Shan's Home Page
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../misc/jasmine/" title="Jasmine" class="md-nav__link">
      Jasmine
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../misc/essential/" title="Essential" class="md-nav__link">
      Essential
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../misc/cheatsheet/" title="Cheatsheet" class="md-nav__link">
      Cheatsheet
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      RDMA
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        RDMA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rdma/rdma/" title="RDMA" class="md-nav__link">
      RDMA
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Papers
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Papers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../read/fast18/" title="FAST 18" class="md-nav__link">
      FAST 18
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../read/asplos18/" title="ASPLOS 18" class="md-nav__link">
      ASPLOS 18
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Lego
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Lego
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-1" type="checkbox" id="nav-7-1" checked>
    
    <label class="md-nav__link" for="nav-7-1">
      Log
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-1">
        Log
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../TODO/" title="TODO" class="md-nav__link">
      TODO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../misc/" title="MISC" class="md-nav__link">
      MISC
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Aug 2018
      </label>
    
    <a href="./" title="Aug 2018" class="md-nav__link md-nav__link--active">
      Aug 2018
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aug-29" title="Aug 29" class="md-nav__link">
    Aug 29
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-27" title="Aug 27" class="md-nav__link">
    Aug 27
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-26" title="Aug 26" class="md-nav__link">
    Aug 26
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-22" title="Aug 22" class="md-nav__link">
    Aug 22
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-04-2018/" title="April 2018" class="md-nav__link">
      April 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-03-2018/" title="March 2018" class="md-nav__link">
      March 2018
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../log-02-2018/" title="Feb 2018" class="md-nav__link">
      Feb 2018
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-2" type="checkbox" id="nav-7-2">
    
    <label class="md-nav__link" for="nav-7-2">
      Kernel
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-2">
        Kernel
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/kconfig/" title="Kconfig" class="md-nav__link">
      Kconfig
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/debug/" title="Debug" class="md-nav__link">
      Debug
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/grub/" title="GRUB" class="md-nav__link">
      GRUB
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/profile/" title="Profile" class="md-nav__link">
      Profile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/profile_strace/" title="Profile strace" class="md-nav__link">
      Profile strace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/profile_heatmap/" title="Profile heatmap" class="md-nav__link">
      Profile heatmap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/profile_points/" title="Profile points" class="md-nav__link">
      Profile points
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/trampoline/" title="Trampoline" class="md-nav__link">
      Trampoline
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/pagefault_disable/" title="Disable pgfault" class="md-nav__link">
      Disable pgfault
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/stop_machine/" title="Stop machine" class="md-nav__link">
      Stop machine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/loader/" title="Program Loader" class="md-nav__link">
      Program Loader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/vDSO/" title="vDSO" class="md-nav__link">
      vDSO
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/vfs/" title="Virtual File System" class="md-nav__link">
      Virtual File System
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/vm/" title="Process Virtual Memory" class="md-nav__link">
      Process Virtual Memory
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/fpu/" title="x86 FPU" class="md-nav__link">
      x86 FPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/irq/" title="IRQ" class="md-nav__link">
      IRQ
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/net_thpool/" title="Network Thpool" class="md-nav__link">
      Network Thpool
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-3" type="checkbox" id="nav-7-3">
    
    <label class="md-nav__link" for="nav-7-3">
      Syscall
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-3">
        Syscall
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/facts/" title="Facts" class="md-nav__link">
      Facts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../kernel/profile_strace/" title="strace" class="md-nav__link">
      strace
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/compat/" title="compat" class="md-nav__link">
      compat
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/msync/" title="msync()" class="md-nav__link">
      msync()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/mremap/" title="mremap()" class="md-nav__link">
      mremap()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/fork/" title="fork()" class="md-nav__link">
      fork()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/getrusage/" title="getrusage()" class="md-nav__link">
      getrusage()
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../syscall/wait_and_exit/" title="wait4 and exit()" class="md-nav__link">
      wait4 and exit()
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-4" type="checkbox" id="nav-7-4">
    
    <label class="md-nav__link" for="nav-7-4">
      Pcache
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-4">
        Pcache
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/config/" title="Config" class="md-nav__link">
      Config
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/sweep/" title="Sweep" class="md-nav__link">
      Sweep
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/tlb/" title="TLB Coherence" class="md-nav__link">
      TLB Coherence
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/pgtable-lock/" title="PageTable Lock" class="md-nav__link">
      PageTable Lock
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/victim/" title="Victim Cache" class="md-nav__link">
      Victim Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/virtual_cache/" title="Virtual Cache" class="md-nav__link">
      Virtual Cache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/rmap/" title="Reverse Mapping" class="md-nav__link">
      Reverse Mapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/evict_and_ref/" title="Evict and Refcount" class="md-nav__link">
      Evict and Refcount
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/smp_design/" title="SMP Design" class="md-nav__link">
      SMP Design
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pcache/replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-5" type="checkbox" id="nav-7-5">
    
    <label class="md-nav__link" for="nav-7-5">
      Driver
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-5">
        Driver
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../driver/pci/" title="PCI" class="md-nav__link">
      PCI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../driver/ib/" title="Infiniband" class="md-nav__link">
      Infiniband
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7-6" type="checkbox" id="nav-7-6">
    
    <label class="md-nav__link" for="nav-7-6">
      Paper
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-7-6">
        Paper
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../paper/nmp/" title="NMP" class="md-nav__link">
      NMP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../paper/processor_oom/" title="Processor OOM" class="md-nav__link">
      Processor OOM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../paper/genz/" title="Gen-Z" class="md-nav__link">
      Gen-Z
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../paper/replication/" title="Replication" class="md-nav__link">
      Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../paper/related/" title="Related" class="md-nav__link">
      Related
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aug-29" title="Aug 29" class="md-nav__link">
    Aug 29
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-27" title="Aug 27" class="md-nav__link">
    Aug 27
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-26" title="Aug 26" class="md-nav__link">
    Aug 26
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aug-22" title="Aug 22" class="md-nav__link">
    Aug 22
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="aug-2018">Aug 2018</h1>
<h2 id="aug-29">Aug 29</h2>
<p>The only thing left about core_IB is: ib_sa_query, which will be invoked when there is a mlx4 interrupts.</p>
<p>Not sure if this is important.</p>
<p>Anyway. Testing TF 4 threads MNIST again.</p>
<p>When I enable SEQ_IBAPI：</p>
<ul>
<li>0829-w14-11 (0829-w09-11) succeed</li>
<li>0829-w14-12: P side seems have deadlock. Let me enable DEBUG_SPINLOCK.</li>
<li>
<p>0829-w14-13: SEQ_IBAPI, DEBUG_SPINLOCK, this is a very useful log:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">[</span>  <span class="mf">531.495545</span><span class="p">]</span> <span class="nl">STDOUT</span><span class="p">:</span> <span class="o">---</span><span class="p">[</span>
<span class="nl">INFO</span><span class="p">:</span><span class="nl">tensorflow</span><span class="p">:</span><span class="n">loss</span> <span class="o">=</span> <span class="mf">0.5256375</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">101</span> <span class="p">(</span><span class="mf">25.166</span> <span class="n">sec</span><span class="p">)</span>

<span class="p">]</span><span class="o">---</span>
<span class="p">[</span>  <span class="mf">531.624474</span><span class="p">]</span> <span class="nl">BUG</span><span class="p">:</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">kernel</span> <span class="nb">NULL</span> <span class="n">pointer</span> <span class="n">dereference</span> <span class="n">at</span> <span class="mo">0000000000000064</span>
<span class="p">[</span>  <span class="mf">531.633016</span><span class="p">]</span> <span class="nl">IP</span><span class="p">:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b60e</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__put_victim_nolist</span><span class="o">+</span><span class="mh">0xe</span><span class="o">/</span><span class="mh">0xa0</span>
<span class="p">[</span>  <span class="mf">531.639803</span><span class="p">]</span> <span class="n">PGD</span> <span class="mi">0</span>
<span class="p">[</span>  <span class="mf">531.642032</span><span class="p">]</span> <span class="nl">Oops</span><span class="p">:</span> <span class="mo">0002</span> <span class="p">[</span><span class="err">#</span><span class="mi">1</span><span class="p">]</span> <span class="n">SMP</span> <span class="n">PROCESSOR</span>
<span class="p">[</span>  <span class="mf">531.646493</span><span class="p">]</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mi">10</span> <span class="nl">PID</span><span class="p">:</span> <span class="mi">20</span> <span class="nl">Comm</span><span class="p">:</span> <span class="n">kvictim_flushd</span> <span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span> <span class="err">#</span><span class="mi">426</span>
<span class="p">[</span>  <span class="mf">531.653279</span><span class="p">]</span> <span class="nl">RIP</span><span class="p">:</span> <span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b60e</span><span class="o">&gt;</span><span class="p">]</span>  <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b60e</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__put_victim_nolist</span><span class="o">+</span><span class="mh">0xe</span><span class="o">/</span><span class="mh">0xa0</span>
<span class="p">[</span>  <span class="mf">531.662781</span><span class="p">]</span> <span class="nl">RSP</span><span class="p">:</span> <span class="mo">0000</span><span class="o">:</span><span class="n">ffff880fe392fde0</span>  <span class="nl">EFLAGS</span><span class="p">:</span> <span class="mo">00010006</span>
<span class="p">[</span>  <span class="mf">531.668696</span><span class="p">]</span> <span class="nl">RAX</span><span class="p">:</span> <span class="mo">0000000000000000</span> <span class="nl">RBX</span><span class="p">:</span> <span class="n">ffffffff810c2b00</span> <span class="nl">RCX</span><span class="p">:</span> <span class="n">ffffffff810c2b70</span>
<span class="p">[</span>  <span class="mf">531.676646</span><span class="p">]</span> <span class="nl">RDX</span><span class="p">:</span> <span class="n">ffffffff810c2b70</span> <span class="nl">RSI</span><span class="p">:</span> <span class="mo">0000007</span><span class="n">aea3f42fa</span> <span class="nl">RDI</span><span class="p">:</span> <span class="n">ffffffff810c2b00</span>
<span class="p">[</span>  <span class="mf">531.684597</span><span class="p">]</span> <span class="nl">RBP</span><span class="p">:</span> <span class="n">ffff880fe392fdf0</span> <span class="nl">R08</span><span class="p">:</span> <span class="mf">000000000000001f</span> <span class="nl">R09</span><span class="p">:</span> <span class="mo">0000000000000002</span>
<span class="p">[</span>  <span class="mf">531.692548</span><span class="p">]</span> <span class="nl">R10</span><span class="p">:</span> <span class="mo">00000000</span><span class="mi">80000000</span> <span class="nl">R11</span><span class="p">:</span> <span class="mo">00000000000664</span><span class="n">c3</span> <span class="nl">R12</span><span class="p">:</span> <span class="n">ffff88207ff57000</span>
<span class="p">[</span>  <span class="mf">531.700498</span><span class="p">]</span> <span class="nl">R13</span><span class="p">:</span> <span class="n">ffffffff810c2b60</span> <span class="nl">R14</span><span class="p">:</span> <span class="n">ffff880a72555000</span> <span class="nl">R15</span><span class="p">:</span> <span class="n">ffffffff810c2b48</span>
<span class="p">[</span>  <span class="mf">531.708449</span><span class="p">]</span> <span class="nl">FS</span><span class="p">:</span>  <span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span> <span class="nl">GS</span><span class="p">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span> <span class="nl">knlGS</span><span class="p">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span>  <span class="mf">531.717466</span><span class="p">]</span> <span class="nl">CS</span><span class="p">:</span>  <span class="mo">0010</span> <span class="nl">DS</span><span class="p">:</span> <span class="mo">0000</span> <span class="nl">ES</span><span class="p">:</span> <span class="mo">0000</span> <span class="nl">CR0</span><span class="p">:</span> <span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span>  <span class="mf">531.723865</span><span class="p">]</span> <span class="nl">CR2</span><span class="p">:</span> <span class="mo">0000000000000064</span> <span class="nl">CR3</span><span class="p">:</span> <span class="mo">00000000011</span><span class="n">b9000</span> <span class="nl">CR4</span><span class="p">:</span> <span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span>  <span class="mf">531.731816</span><span class="p">]</span> <span class="nl">Stack</span><span class="p">:</span>
<span class="p">[</span>  <span class="mf">531.734046</span><span class="p">]</span> <span class="n">ffffffff810c2b00</span> <span class="n">ffff88207ff57000</span> <span class="n">ffff880fe392fe08</span> <span class="n">ffffffff8103bbea</span>
<span class="p">[</span>  <span class="mf">531.742190</span><span class="p">]</span> <span class="n">ffffffff810c2b00</span> <span class="n">ffff880fe392fe48</span> <span class="n">ffffffff8103c729</span> <span class="mo">00000000</span><span class="mi">8103</span><span class="n">d7c2</span>
<span class="p">[</span>  <span class="mf">531.750335</span><span class="p">]</span> <span class="n">ffff880a72555060</span> <span class="n">ffff88107ff0fdc8</span> <span class="mo">0000000000000000</span> <span class="n">ffffffff8103c780</span>
<span class="p">[</span>  <span class="mf">531.758479</span><span class="p">]</span> <span class="mo">0000000000000000</span> <span class="n">ffff880fe392fe60</span> <span class="n">ffffffff8103c7e6</span> <span class="n">ffff880fe391c000</span>
<span class="p">[</span>  <span class="mf">531.766623</span><span class="p">]</span> <span class="n">ffff880fe392ff48</span> <span class="n">ffffffff81022e81</span> <span class="mo">0000000000000000</span> <span class="mo">0000000000000000</span>
<span class="p">[</span>  <span class="mf">531.774768</span><span class="p">]</span> <span class="n">Call</span> <span class="nl">Trace</span><span class="p">:</span>
<span class="p">[</span>  <span class="mf">531.777483</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span>  <span class="mf">531.779617</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103bbea</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__put_victim</span><span class="o">+</span><span class="mh">0x4a</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span>  <span class="mf">531.785433</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c729</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__victim_flush_func</span><span class="o">+</span><span class="mh">0xb9</span><span class="o">/</span><span class="mh">0x110</span>
<span class="p">[</span>  <span class="mf">531.792027</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c780</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__victim_flush_func</span><span class="o">+</span><span class="mh">0x110</span><span class="o">/</span><span class="mh">0x110</span>
<span class="p">[</span>  <span class="mf">531.798911</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c7e6</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">victim_flush_async</span><span class="o">+</span><span class="mh">0x66</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span>  <span class="mf">531.805310</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81022e81</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">kthread</span><span class="o">+</span><span class="mh">0x111</span><span class="o">/</span><span class="mh">0x130</span>
<span class="p">[</span>  <span class="mf">531.810836</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81022d70</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span>  <span class="mf">531.817236</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100eb32</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span>  <span class="mf">531.823151</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">EOT</span><span class="o">&gt;</span>
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>0829-w14-14: this looks like a double free, or concurrent eviction. But if you look into the evict code, we will check the Flushed flag. It means another eviction routine should have skipped this line, and will not pick this line to do eviction. Some other possibilities?</p>
</li>
<li>check until 0829-w14-18
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">[</span> <span class="mf">1671.661424</span><span class="p">]</span> <span class="o">------------</span><span class="p">[</span> <span class="n">cut</span> <span class="n">here</span> <span class="p">]</span><span class="o">------------</span>
<span class="p">[</span> <span class="mf">1671.666378</span><span class="p">]</span> <span class="nl">BUG</span><span class="p">:</span> <span class="n">failure</span> <span class="n">at</span> <span class="n">managers</span><span class="o">/</span><span class="n">processor</span><span class="o">/</span><span class="n">pcache</span><span class="o">/</span><span class="n">victim</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">610</span><span class="o">/</span><span class="n">victim_finish_insert</span><span class="p">()</span><span class="o">!</span>
<span class="p">[</span> <span class="mf">1671.675591</span><span class="p">]</span> <span class="n">Kernel</span> <span class="n">Panic</span> <span class="o">-</span> <span class="n">not</span> <span class="nl">syncing</span><span class="p">:</span> <span class="n">BUG</span><span class="o">!</span>
<span class="p">[</span> <span class="mf">1671.680339</span><span class="p">]</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mi">20</span> <span class="nl">PID</span><span class="p">:</span> <span class="mi">31</span> <span class="nl">Comm</span><span class="p">:</span> <span class="n">python</span> <span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span> <span class="err">#</span><span class="mi">426</span>
<span class="p">[</span> <span class="mf">1671.686351</span><span class="p">]</span> <span class="nl">Stack</span><span class="p">:</span>
<span class="p">[</span> <span class="mf">1671.688581</span><span class="p">]</span> <span class="n">ffff880fbe76fda0</span> <span class="n">ffffffff810289b7</span> <span class="n">ffffffff00000008</span> <span class="n">ffff880fbe76fdb0</span>
<span class="p">[</span> <span class="mf">1671.696725</span><span class="p">]</span> <span class="n">ffff880fbe76fd68</span> <span class="n">ffffff0021475542</span> <span class="n">ffff88107fd45e00</span> <span class="n">ffff880fbe753000</span>
<span class="p">[</span> <span class="mf">1671.704870</span><span class="p">]</span> <span class="mo">0000000000000000</span> <span class="mo">0000000000000001</span> <span class="n">ffff880fbe76f9b0</span> <span class="n">ffffffff8101b1b7</span>
<span class="p">[</span> <span class="mf">1671.713015</span><span class="p">]</span> <span class="n">ffff88107fd44980</span> <span class="n">ffff880fbe76f9d8</span> <span class="n">ffffffff8101405f</span> <span class="mo">0000000000000000</span>
<span class="p">[</span> <span class="mf">1671.721160</span><span class="p">]</span> <span class="mo">0000000000000001</span> <span class="n">ffff880ff992a000</span> <span class="mo">0000000000000001</span> <span class="n">ffff880fbe76f9f0</span>
<span class="p">[</span> <span class="mf">1671.729304</span><span class="p">]</span> <span class="n">Call</span> <span class="nl">Trace</span><span class="p">:</span>
<span class="p">[</span> <span class="mf">1671.732019</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span> <span class="mf">1671.734153</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810289c3</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">panic</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x10a</span>
<span class="p">[</span> <span class="mf">1671.739388</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b1b7</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x57</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span> <span class="mf">1671.745593</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101405f</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">generic_smp_call_function_single_interrupt</span><span class="o">+</span><span class="mh">0x8f</span><span class="o">/</span><span class="mh">0x160</span>
<span class="p">[</span> <span class="mf">1671.754611</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100339e</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">call_function_interrupt</span><span class="o">+</span><span class="mh">0x2e</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span> <span class="mf">1671.761688</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e9fa</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">smp__call_function_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span> <span class="mf">1671.769251</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f4bb</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">debug_spin_lock</span><span class="o">+</span><span class="mh">0x1b</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span> <span class="mf">1671.775555</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81075efc</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0x6c</span><span class="o">/</span><span class="mh">0x140</span>
<span class="p">[</span> <span class="mf">1671.782826</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81042039</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">find_next_bit</span><span class="o">+</span><span class="mh">0x19</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span> <span class="mf">1671.788934</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101f4bb</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">debug_spin_lock</span><span class="o">+</span><span class="mh">0x1b</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span> <span class="mf">1671.795236</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101dcac</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">task_tick_rt</span><span class="o">+</span><span class="mh">0x2c</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span> <span class="mf">1671.801248</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101b1b7</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x57</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span> <span class="mf">1671.807453</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810174d5</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">tick_handle_periodic</span><span class="o">+</span><span class="mh">0x45</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span> <span class="mf">1671.814240</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81006774</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0x90</span>
<span class="p">[</span> <span class="mf">1671.821029</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e8aa</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">smp__apic_timer_interrupt</span><span class="o">+</span><span class="mh">0x6a</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span> <span class="mf">1671.828300</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81012bc8</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">printk</span><span class="o">+</span><span class="mh">0x118</span><span class="o">/</span><span class="mh">0x1b0</span>
<span class="p">[</span> <span class="mf">1671.833924</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103c161</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">victim_finish_insert</span><span class="o">+</span><span class="mh">0x171</span><span class="o">/</span><span class="mh">0x180</span>
<span class="p">[</span> <span class="mf">1671.840711</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103b2a2</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">pcache_evict_line</span><span class="o">+</span><span class="mh">0xf2</span><span class="o">/</span><span class="mh">0x2e0</span>
<span class="p">[</span> <span class="mf">1671.847110</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81038d7c</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">pcache_alloc</span><span class="o">+</span><span class="mh">0x1ac</span><span class="o">/</span><span class="mh">0x380</span>
<span class="p">[</span> <span class="mf">1671.853122</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103a10c</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">pcache_add_rmap</span><span class="o">+</span><span class="mh">0x7c</span><span class="o">/</span><span class="mh">0x260</span>
<span class="p">[</span> <span class="mf">1671.859521</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810382bb</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">common_do_fill_page</span><span class="o">+</span><span class="mh">0x2b</span><span class="o">/</span><span class="mh">0x1e0</span>
<span class="p">[</span> <span class="mf">1671.866114</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81038631</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">pcache_handle_fault</span><span class="o">+</span><span class="mh">0x1c1</span><span class="o">/</span><span class="mh">0x620</span>
<span class="p">[</span> <span class="mf">1671.872804</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81037fc0</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">pcache_meta_to_kva</span><span class="o">+</span><span class="mh">0x30</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span> <span class="mf">1671.879398</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8101006f</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">do_page_fault</span><span class="o">+</span><span class="mh">0xaf</span><span class="o">/</span><span class="mh">0x1c0</span>
<span class="p">[</span> <span class="mf">1671.885410</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100dedf</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">page_fault</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0x30</span>
</pre></div>
</td></tr></table></li>
</ul>
<h2 id="aug-27">Aug 27</h2>
<p>There a lot lost CQE cases. This one is about P-&gt;M-&gt;S. And M lost the CQE for the WQE sent to S.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mi">0827</span><span class="o">-</span><span class="n">w9</span><span class="o">-</span><span class="mi">5</span>
<span class="p">[</span>  <span class="mf">963.304865</span><span class="p">]</span> <span class="nl">watchdog</span><span class="p">:</span> <span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="n">CPU10</span> <span class="n">stucked</span>
<span class="p">[</span>  <span class="mf">963.309712</span><span class="p">]</span> <span class="nl">watchdog</span><span class="p">:</span>  <span class="n">common_header</span> <span class="p">[</span><span class="n">op</span><span class="o">=</span><span class="mh">0x20000000</span> <span class="nl">src_nid</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span>  <span class="mf">963.316210</span><span class="p">]</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mi">10</span> <span class="nl">PID</span><span class="p">:</span> <span class="mi">20</span> <span class="nl">Comm</span><span class="p">:</span> <span class="n">thpool</span><span class="o">-</span><span class="n">worker0</span> <span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span> <span class="err">#</span><span class="mi">43</span>
<span class="p">[</span>  <span class="mf">963.322899</span><span class="p">]</span> <span class="nl">RIP</span><span class="p">:</span> <span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106ad51</span><span class="o">&gt;</span><span class="p">]</span>  <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106ad51</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_send_reply_with_rdma_write_with_imm</span><span class="o">+</span><span class="mh">0x2a1</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span>  <span class="mf">963.334632</span><span class="p">]</span> <span class="nl">RSP</span><span class="p">:</span> <span class="mo">0000</span><span class="o">:</span><span class="n">ffff88103ef3fc20</span>  <span class="nl">EFLAGS</span><span class="p">:</span> <span class="mo">000002</span><span class="mi">87</span>
<span class="p">[</span>  <span class="mf">963.340547</span><span class="p">]</span> <span class="nl">RAX</span><span class="p">:</span> <span class="mf">00000000ff</span><span class="n">ffb6d4</span> <span class="nl">RBX</span><span class="p">:</span> <span class="mo">000000000000000</span><span class="n">b</span> <span class="nl">RCX</span><span class="p">:</span> <span class="mo">0000000000001770</span>
<span class="p">[</span>  <span class="mf">963.348498</span><span class="p">]</span> <span class="nl">RDX</span><span class="p">:</span> <span class="mf">00000000ff</span><span class="n">ffa70d</span> <span class="nl">RSI</span><span class="p">:</span> <span class="n">fffffffffffff039</span> <span class="nl">RDI</span><span class="p">:</span> <span class="mo">0000000000000000</span>
<span class="p">[</span>  <span class="mf">963.356450</span><span class="p">]</span> <span class="nl">RBP</span><span class="p">:</span> <span class="n">ffff88103ef3fcc0</span> <span class="nl">R08</span><span class="p">:</span> <span class="mf">000000000000001f</span> <span class="nl">R09</span><span class="p">:</span> <span class="mo">0000000000000002</span>
<span class="p">[</span>  <span class="mf">963.364400</span><span class="p">]</span> <span class="nl">R10</span><span class="p">:</span> <span class="mo">00000000</span><span class="mi">80000000</span> <span class="nl">R11</span><span class="p">:</span> <span class="mf">000077ff</span><span class="mi">80000000</span> <span class="nl">R12</span><span class="p">:</span> <span class="mo">0000000000000000</span>
<span class="p">[</span>  <span class="mf">963.372352</span><span class="p">]</span> <span class="nl">R13</span><span class="p">:</span> <span class="n">ffff88103ef26738</span> <span class="nl">R14</span><span class="p">:</span> <span class="mo">00000000000</span><span class="n">b3d54</span> <span class="nl">R15</span><span class="p">:</span> <span class="n">ffff88103ef25008</span>
<span class="p">[</span>  <span class="mf">963.380303</span><span class="p">]</span> <span class="nl">FS</span><span class="p">:</span>  <span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span> <span class="nl">GS</span><span class="p">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span> <span class="nl">knlGS</span><span class="p">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span>  <span class="mf">963.389320</span><span class="p">]</span> <span class="nl">CS</span><span class="p">:</span>  <span class="mo">0010</span> <span class="nl">DS</span><span class="p">:</span> <span class="mo">0000</span> <span class="nl">ES</span><span class="p">:</span> <span class="mo">0000</span> <span class="nl">CR0</span><span class="p">:</span> <span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span>  <span class="mf">963.395720</span><span class="p">]</span> <span class="nl">CR2</span><span class="p">:</span> <span class="mo">0000000000000000</span> <span class="nl">CR3</span><span class="p">:</span> <span class="mo">000000000116</span><span class="n">a000</span> <span class="nl">CR4</span><span class="p">:</span> <span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span>  <span class="mf">963.403671</span><span class="p">]</span> <span class="nl">Stack</span><span class="p">:</span>
<span class="p">[</span>  <span class="mf">963.405901</span><span class="p">]</span> <span class="mf">00007ff</span><span class="n">f000b3d54</span> <span class="n">ffffffff800b3d54</span> <span class="n">ffff881000000004</span> <span class="n">ffff88103ef3fc78</span>
<span class="p">[</span>  <span class="mf">963.414045</span><span class="p">]</span> <span class="mo">0000000</span><span class="mi">900000000</span> <span class="n">ffff881000000000</span> <span class="mo">0000100</span><span class="mi">800000001</span> <span class="n">ffff88103d216000</span>
<span class="p">[</span>  <span class="mf">963.422191</span><span class="p">]</span> <span class="n">ffff88103eebae48</span> <span class="mi">800</span><span class="n">b3d540000011c</span> <span class="n">ffffff9b00000246</span> <span class="n">ffffea0000000001</span>
<span class="p">[</span>  <span class="mf">963.430337</span><span class="p">]</span> <span class="mo">000000103</span><span class="n">d216000</span> <span class="mo">0000000000010</span><span class="n">c00</span> <span class="mo">000000000000011</span><span class="n">c</span> <span class="mo">000000000000100</span><span class="mi">8</span>
<span class="p">[</span>  <span class="mf">963.438481</span><span class="p">]</span> <span class="mo">000000000000011</span><span class="n">c</span> <span class="mo">000000000000100</span><span class="mi">8</span> <span class="n">ffff88103eebae48</span> <span class="n">ffff88103ef3fd70</span>
<span class="p">[</span>  <span class="mf">963.446626</span><span class="p">]</span> <span class="n">Call</span> <span class="nl">Trace</span><span class="p">:</span>
<span class="p">[</span>  <span class="mf">963.449342</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span>  <span class="mf">963.451475</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81067c80</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">ibapi_send_reply_imm</span><span class="o">+</span><span class="mh">0x50</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span>  <span class="mf">963.458068</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e953</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__storage_read</span><span class="o">+</span><span class="mh">0xc3</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span>  <span class="mf">963.464371</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e953</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__storage_read</span><span class="o">+</span><span class="mh">0xc3</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span>  <span class="mf">963.470480</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e9bf</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">storage_read</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x50</span>
<span class="p">[</span>  <span class="mf">963.476201</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102eab7</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">storage_vma_fault</span><span class="o">+</span><span class="mh">0xb7</span><span class="o">/</span><span class="mh">0x130</span>
<span class="p">[</span>  <span class="mf">963.482600</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103262f</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">handle_lego_mm_fault</span><span class="o">+</span><span class="mh">0x13f</span><span class="o">/</span><span class="mh">0x4a0</span>
<span class="p">[</span>  <span class="mf">963.489389</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102ecf4</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">common_handle_p2m_miss</span><span class="p">.</span><span class="n">isra</span><span class="mf">.1</span><span class="o">+</span><span class="mh">0x54</span><span class="o">/</span><span class="mh">0xc0</span>
<span class="p">[</span>  <span class="mf">963.496855</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102edc7</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">handle_p2m_pcache_miss</span><span class="o">+</span><span class="mh">0x67</span><span class="o">/</span><span class="mh">0x2d0</span>
<span class="p">[</span>  <span class="mf">963.503739</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bf96</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">thpool_worker_func</span><span class="o">+</span><span class="mh">0x296</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span>  <span class="mf">963.510332</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bd00</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">handle_bad_request</span><span class="o">+</span><span class="mh">0x40</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span>  <span class="mf">963.516926</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020ca6</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">kthread</span><span class="o">+</span><span class="mh">0xf6</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span>  <span class="mf">963.522357</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020bb0</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span>  <span class="mf">963.528756</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e632</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>
</pre></div>
</td></tr></table></p>
<p>hmm, another on lost CQE happen at P.
Today is weird, why we happen to have so many lost CQE today?</p>
<p>Think about why CQE is not generated?</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="mi">0827</span><span class="o">-</span><span class="n">w14</span><span class="o">-</span><span class="mi">6</span>
<span class="p">[</span> <span class="mf">1185.835707</span><span class="p">]</span>
<span class="o">*****</span>
<span class="o">*****</span> <span class="n">Fail</span> <span class="n">to</span> <span class="n">to</span> <span class="n">get</span> <span class="n">the</span> <span class="n">CQE</span> <span class="n">from</span> <span class="n">send_cq</span> <span class="n">after</span> <span class="mi">20</span> <span class="n">seconds</span><span class="o">!</span>
<span class="o">*****</span> <span class="n">This</span> <span class="n">means</span> <span class="n">the</span> <span class="n">packet</span> <span class="n">was</span> <span class="n">lost</span> <span class="n">and</span> <span class="n">something</span> <span class="n">went</span> <span class="n">wrong</span>
<span class="o">*****</span> <span class="n">with</span> <span class="n">your</span> <span class="n">NIC</span><span class="p">...</span>
<span class="o">*****</span> <span class="nl">connection_id</span><span class="p">:</span> <span class="mi">7</span> <span class="n">dest</span> <span class="nl">node</span><span class="p">:</span> <span class="mi">1</span>
<span class="o">*****</span>
<span class="p">[</span> <span class="mf">1185.856465</span><span class="p">]</span> <span class="n">IB</span> <span class="nl">Stats</span><span class="p">:</span>
<span class="p">[</span> <span class="mf">1185.858985</span><span class="p">]</span>     <span class="nl">nr_ib_send_reply</span><span class="p">:</span>            <span class="mi">3452</span>
<span class="p">[</span> <span class="mf">1185.864221</span><span class="p">]</span>     <span class="nl">nr_bytes_tx</span><span class="p">:</span>               <span class="mi">506507</span>
<span class="p">[</span> <span class="mf">1185.869456</span><span class="p">]</span>     <span class="nl">nr_bytes_rx</span><span class="p">:</span>              <span class="mi">8981004</span>
<span class="p">[</span> <span class="mf">1185.874692</span><span class="p">]</span> <span class="o">------------</span><span class="p">[</span> <span class="n">cut</span> <span class="n">here</span> <span class="p">]</span><span class="o">------------</span>
<span class="p">[</span> <span class="mf">1185.879829</span><span class="p">]</span> <span class="nl">WARNING</span><span class="p">:</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mi">14</span> <span class="nl">PID</span><span class="p">:</span> <span class="mi">22</span> <span class="n">at</span> <span class="n">net</span><span class="o">/</span><span class="n">lego</span><span class="o">/</span><span class="n">fit_internal</span><span class="p">.</span><span class="nl">c</span><span class="p">:</span><span class="mi">1108</span> <span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0xe5</span><span class="o">/</span><span class="mh">0x140</span>
<span class="p">[</span> <span class="mf">1185.890399</span><span class="p">]</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mi">14</span> <span class="nl">PID</span><span class="p">:</span> <span class="mi">22</span> <span class="nl">Comm</span><span class="p">:</span> <span class="n">python</span> <span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span> <span class="err">#</span><span class="mi">356</span>
<span class="p">[</span> <span class="mf">1185.896410</span><span class="p">]</span> <span class="nl">Stack</span><span class="p">:</span>
<span class="p">[</span> <span class="mf">1185.898640</span><span class="p">]</span> <span class="n">ffff88103c49fb30</span> <span class="n">ffffffff810126f5</span> <span class="n">ffff88103cb22000</span> <span class="mo">00000004</span><span class="n">a817c800</span>
<span class="p">[</span> <span class="mf">1185.906784</span><span class="p">]</span> <span class="mf">0000010f7139214f</span> <span class="mo">0000000000000007</span> <span class="n">ffff88103c49fb40</span> <span class="n">ffffffff810127cf</span>
<span class="p">[</span> <span class="mf">1185.914927</span><span class="p">]</span> <span class="n">ffff88103c49fbf0</span> <span class="n">ffffffff810724b5</span> <span class="mo">000000023</span><span class="n">cb2c280</span> <span class="n">ffff88103cb2c1f8</span>
<span class="p">[</span> <span class="mf">1185.923072</span><span class="p">]</span> <span class="mo">00000000000002</span><span class="mi">86</span> <span class="n">ffff88103c49fc18</span> <span class="n">ffff88103cb06000</span> <span class="n">ffff88103cb2c150</span>
<span class="p">[</span> <span class="mf">1185.931217</span><span class="p">]</span> <span class="mo">000000000000024</span><span class="n">b</span> <span class="n">ffff88108101c7dc</span> <span class="n">ffff88107fce5d80</span> <span class="n">ffff88103c46f000</span>
<span class="p">[</span> <span class="mf">1185.939360</span><span class="p">]</span> <span class="n">Call</span> <span class="nl">Trace</span><span class="p">:</span>
<span class="p">[</span> <span class="mf">1185.942075</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span> <span class="mf">1185.944209</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81012701</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__warn</span><span class="p">.</span><span class="n">constprop</span><span class="mf">.1</span><span class="o">+</span><span class="mh">0x91</span><span class="o">/</span><span class="mh">0xd0</span>
<span class="p">[</span> <span class="mf">1185.950607</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810127cf</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">warn_slowpath_null</span><span class="o">+</span><span class="mh">0xf</span><span class="o">/</span><span class="mh">0x20</span>
<span class="p">[</span> <span class="mf">1185.956909</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810724b5</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0xe5</span><span class="o">/</span><span class="mh">0x140</span>
<span class="p">[</span> <span class="mf">1185.963987</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81019dd5</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x55</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span> <span class="mf">1185.970192</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81072662</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span> <span class="mf">1185.979791</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810741ff</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_send_reply_with_rdma_write_with_imm</span><span class="o">+</span><span class="mh">0x25f</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span> <span class="mf">1185.988420</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810368c2</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__pcache_do_fill_page</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x1d0</span>
<span class="p">[</span> <span class="mf">1185.995401</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810701e9</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">ibapi_send_reply_timeout</span><span class="o">+</span><span class="mh">0x79</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span> <span class="mf">1186.002479</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810368c2</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__pcache_do_fill_page</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x1d0</span>
<span class="p">[</span> <span class="mf">1186.009459</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810368c2</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">__pcache_do_fill_page</span><span class="o">+</span><span class="mh">0xc2</span><span class="o">/</span><span class="mh">0x1d0</span>
<span class="p">[</span> <span class="mf">1186.016245</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036ac4</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">common_do_fill_page</span><span class="o">+</span><span class="mh">0xf4</span><span class="o">/</span><span class="mh">0x1f0</span>
<span class="p">[</span> <span class="mf">1186.022839</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036d80</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">pcache_handle_fault</span><span class="o">+</span><span class="mh">0x1c0</span><span class="o">/</span><span class="mh">0x610</span>
<span class="p">[</span> <span class="mf">1186.029528</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81036800</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__pcache_do_zerofill_page</span><span class="o">+</span><span class="mh">0x100</span><span class="o">/</span><span class="mh">0x100</span>
<span class="p">[</span> <span class="mf">1186.036995</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100fdff</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">do_page_fault</span><span class="o">+</span><span class="mh">0xaf</span><span class="o">/</span><span class="mh">0x1c0</span>
<span class="p">[</span> <span class="mf">1186.043005</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100dc1f</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">page_fault</span><span class="o">+</span><span class="mh">0x1f</span><span class="o">/</span><span class="mh">0x30</span>
</pre></div>
</td></tr></table>

<h2 id="aug-26">Aug 26</h2>
<p>Oh well. I saw the same damn lost packet issue again. The issue can be desribed as: P use lite rpc to send a request to M. M processed the handled, and called rpc reply to sent back to P. M need to poll send_cq to poll completion. But M fail to get the CQE for the should-be-sent-out WQE.</p>
<p>This is tested with M&rsquo;s <code class="codehilite">CONFIG_FIT_NOWAIT</code> optimization, which is basically an optimization that M will not poll cq every time a reply was sent out, instead, do batch polling.</p>
<p>The following stack dump was reported by M side watchdog. It is not necessary mlx4_poll_cq&rsquo;s issue, since there is a while (1) loop at fit code. Oh well.
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Log</span> <span class="nl">name</span><span class="p">:</span> <span class="mi">0826</span><span class="o">-</span><span class="n">w9</span><span class="o">-</span><span class="mi">1</span>

<span class="p">[</span><span class="mf">187736.669027</span><span class="p">]</span> <span class="nl">watchdog</span><span class="p">:</span> <span class="n">worker</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="n">CPU10</span> <span class="n">stucked</span>
<span class="p">[</span><span class="mf">187736.673972</span><span class="p">]</span> <span class="nl">watchdog</span><span class="p">:</span>  <span class="n">common_header</span> <span class="p">[</span><span class="n">op</span><span class="o">=</span><span class="mh">0x30000000</span> <span class="nl">src_nid</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
<span class="p">[</span><span class="mf">187736.680566</span><span class="p">]</span> <span class="nl">CPU</span><span class="p">:</span> <span class="mi">10</span> <span class="nl">PID</span><span class="p">:</span> <span class="mi">20</span> <span class="nl">Comm</span><span class="p">:</span> <span class="n">thpool</span><span class="o">-</span><span class="n">worker0</span> <span class="mf">4.0.0</span><span class="o">-</span><span class="n">lego</span><span class="o">+</span> <span class="err">#</span><span class="mi">26</span>
<span class="p">[</span><span class="mf">187736.687351</span><span class="p">]</span> <span class="nl">RIP</span><span class="p">:</span> <span class="mo">0010</span><span class="o">:</span><span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810522c3</span><span class="o">&gt;</span><span class="p">]</span>  <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810522c3</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">mlx4_ib_poll_cq</span><span class="o">+</span><span class="mh">0x1d3</span><span class="o">/</span><span class="mh">0x850</span>
<span class="p">[</span><span class="mf">187736.696854</span><span class="p">]</span> <span class="nl">RSP</span><span class="p">:</span> <span class="mo">0000</span><span class="o">:</span><span class="n">ffff88103ef3f750</span>  <span class="nl">EFLAGS</span><span class="p">:</span> <span class="mo">000002</span><span class="mi">86</span>
<span class="p">[</span><span class="mf">187736.702865</span><span class="p">]</span> <span class="nl">RAX</span><span class="p">:</span> <span class="mf">00000000ff</span><span class="n">fffff5</span> <span class="nl">RBX</span><span class="p">:</span> <span class="mo">0000000000000000</span> <span class="nl">RCX</span><span class="p">:</span> <span class="n">ffff88103ed6b050</span>
<span class="p">[</span><span class="mf">187736.710913</span><span class="p">]</span> <span class="nl">RDX</span><span class="p">:</span> <span class="mo">00000000</span><span class="mi">80630000</span> <span class="nl">RSI</span><span class="p">:</span> <span class="mo">0000000000000001</span> <span class="nl">RDI</span><span class="p">:</span> <span class="n">ffff88103edb0bf0</span>
<span class="p">[</span><span class="mf">187736.718961</span><span class="p">]</span> <span class="nl">RBP</span><span class="p">:</span> <span class="n">ffff88103ef3f7b8</span> <span class="nl">R08</span><span class="p">:</span> <span class="mo">0000000000000020</span> <span class="nl">R09</span><span class="p">:</span> <span class="mo">0000000000000002</span>
<span class="p">[</span><span class="mf">187736.727007</span><span class="p">]</span> <span class="nl">R10</span><span class="p">:</span> <span class="mf">0000000ff</span><span class="n">c53fddc</span> <span class="nl">R11</span><span class="p">:</span> <span class="mo">0000000040</span><span class="n">bf1040</span> <span class="nl">R12</span><span class="p">:</span> <span class="n">ffff88103ef3f7c8</span>
<span class="p">[</span><span class="mf">187736.735055</span><span class="p">]</span> <span class="nl">R13</span><span class="p">:</span> <span class="mo">0000000000000000</span> <span class="nl">R14</span><span class="p">:</span> <span class="mo">0000000000000000</span> <span class="nl">R15</span><span class="p">:</span> <span class="n">ffff88103edb0bf0</span>
<span class="p">[</span><span class="mf">187736.743104</span><span class="p">]</span> <span class="nl">FS</span><span class="p">:</span>  <span class="mo">0000000000000000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span> <span class="nl">GS</span><span class="p">:</span><span class="n">ffff88107fca0000</span><span class="p">(</span><span class="mo">0000</span><span class="p">)</span> <span class="nl">knlGS</span><span class="p">:</span><span class="mo">0000000000000000</span>
<span class="p">[</span><span class="mf">187736.752218</span><span class="p">]</span> <span class="nl">CS</span><span class="p">:</span>  <span class="mo">0010</span> <span class="nl">DS</span><span class="p">:</span> <span class="mo">0000</span> <span class="nl">ES</span><span class="p">:</span> <span class="mo">0000</span> <span class="nl">CR0</span><span class="p">:</span> <span class="mo">00000000</span><span class="mi">80050033</span>
<span class="p">[</span><span class="mf">187736.758714</span><span class="p">]</span> <span class="nl">CR2</span><span class="p">:</span> <span class="mo">0000000000000000</span> <span class="nl">CR3</span><span class="p">:</span> <span class="mo">000000000116</span><span class="n">a000</span> <span class="nl">CR4</span><span class="p">:</span> <span class="mo">00000000000406</span><span class="n">a0</span>
<span class="p">[</span><span class="mf">187736.766762</span><span class="p">]</span> <span class="nl">Stack</span><span class="p">:</span>
<span class="p">[</span><span class="mf">187736.769089</span><span class="p">]</span> <span class="mf">0000000ff</span><span class="n">c53fddc</span> <span class="mo">0000000000000002</span> <span class="mo">0000000000000020</span> <span class="n">ffff88103edb0c98</span>
<span class="p">[</span><span class="mf">187736.777331</span><span class="p">]</span> <span class="mo">00000000000002</span><span class="mi">86</span> <span class="mo">00000000</span><span class="mi">80630000</span> <span class="n">ffff88103ef3f7d0</span> <span class="mo">000063</span><span class="mi">8000000018</span>
<span class="p">[</span><span class="mf">187736.785572</span><span class="p">]</span> <span class="n">ffff88103edb0bf0</span> <span class="mo">0000000000000001</span> <span class="n">ffff88103ef25008</span> <span class="mo">0000000000000003</span>
<span class="p">[</span><span class="mf">187736.793813</span><span class="p">]</span> <span class="mo">000000000000000</span><span class="n">c</span> <span class="n">ffff88103ef3fd30</span> <span class="n">ffffffff8106920c</span> <span class="n">ffff88103ef3fd54</span>
<span class="p">[</span><span class="mf">187736.802054</span><span class="p">]</span> <span class="mo">0000000100000000</span> <span class="mo">0000000100000000</span> <span class="n">ffff88103edb07b0</span> <span class="n">ffff88103e81b008</span>
<span class="p">[</span><span class="mf">187736.810296</span><span class="p">]</span> <span class="n">Call</span> <span class="nl">Trace</span><span class="p">:</span>
<span class="p">[</span><span class="mf">187736.813108</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">TSK</span><span class="o">&gt;</span>
<span class="p">[</span><span class="mf">187736.815338</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106920c</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_internal_poll_sendcq</span><span class="o">+</span><span class="mh">0x6c</span><span class="o">/</span><span class="mh">0xe0</span>
<span class="p">[</span><span class="mf">187736.822416</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8106ab2f</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">fit_send_reply_with_rdma_write_with_imm</span><span class="o">+</span><span class="mh">0x25f</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="mf">187736.831336</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81033ff0</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">_lego_copy_to_user</span><span class="o">+</span><span class="mh">0x110</span><span class="o">/</span><span class="mh">0x250</span>
<span class="p">[</span><span class="mf">187736.838220</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81028d65</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__free_pages</span><span class="o">+</span><span class="mh">0x25</span><span class="o">/</span><span class="mh">0x30</span>
<span class="p">[</span><span class="mf">187736.844329</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102e981</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__storage_read</span><span class="o">+</span><span class="mh">0xf1</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="mf">187736.850728</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81019865</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">scheduler_tick</span><span class="o">+</span><span class="mh">0x55</span><span class="o">/</span><span class="mh">0x60</span>
<span class="p">[</span><span class="mf">187736.857031</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810693d2</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="mf">187736.866920</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810693d2</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="mf">187736.876810</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8103043f</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__vma_adjust</span><span class="o">+</span><span class="mh">0x38f</span><span class="o">/</span><span class="mh">0x550</span>
<span class="p">[</span><span class="mf">187736.883113</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81030944</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">vma_merge</span><span class="o">+</span><span class="mh">0x1a4</span><span class="o">/</span><span class="mh">0x280</span>
<span class="p">[</span><span class="mf">187736.889123</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81030f20</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">arch_get_unmapped_area_topdown</span><span class="o">+</span><span class="mh">0xe0</span><span class="o">/</span><span class="mh">0x220</span>
<span class="p">[</span><span class="mf">187736.897075</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff810693d2</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_send_message_with_rdma_write_with_imm_request</span><span class="o">+</span><span class="mh">0x152</span><span class="o">/</span><span class="mh">0x350</span>
<span class="p">[</span><span class="mf">187736.906771</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81069ab5</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">fit_ack_reply_callback</span><span class="o">+</span><span class="mh">0x185</span><span class="o">/</span><span class="mh">0x1e0</span>
<span class="p">[</span><span class="mf">187736.913848</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102f129</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">handle_p2m_flush_one</span><span class="o">+</span><span class="mh">0x69</span><span class="o">/</span><span class="mh">0x160</span>
<span class="p">[</span><span class="mf">187736.920830</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bde0</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">thpool_worker_func</span><span class="o">+</span><span class="mh">0xe0</span><span class="o">/</span><span class="mh">0x3a0</span>
<span class="p">[</span><span class="mf">187736.927424</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8102bd00</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">handle_bad_request</span><span class="o">+</span><span class="mh">0x40</span><span class="o">/</span><span class="mh">0x40</span>
<span class="p">[</span><span class="mf">187736.934113</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020ca6</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">kthread</span><span class="o">+</span><span class="mh">0xf6</span><span class="o">/</span><span class="mh">0x120</span>
<span class="p">[</span><span class="mf">187736.939639</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff81020bb0</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">?</span> <span class="n">__kthread_parkme</span><span class="o">+</span><span class="mh">0x70</span><span class="o">/</span><span class="mh">0x70</span>
<span class="p">[</span><span class="mf">187736.946137</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">ffffffff8100e632</span><span class="o">&gt;</span><span class="p">]</span> <span class="n">ret_from_fork</span><span class="o">+</span><span class="mh">0x22</span><span class="o">/</span><span class="mh">0x30</span>
</pre></div>
</td></tr></table></p>
<h2 id="aug-22">Aug 22</h2>
<p>Damn it!!! After so much effort verifying we had a solid IB stack, we still has memory corruption and deadlock issues. Fuck!</p>
<p>One thing at a time, simple stuff first. Okay, tomorrow first add DEBUG_SPINLOCK to detect possible deadlocks. This, could help to identify some buggy code. After this, I will spend some time looking into the LITE, it&rsquo;s fucking HEAVY. I do found a lot issues during summer.</p>
<p>Personally, I&rsquo;m not feeling good this days. I treat someone with love and respect, but there is not too much in return. Yeahyeahyeah, I know how this works. It&rsquo;s just sad that sometimes you just have a BAD timing. I&rsquo;ve went through too much things in 2018, good and bad. I care sooo much about the people I love, family and others. I feel this is good, of course. Anyway, it is supposed to be a Lego dump, that no one probably interested in.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../misc/" title="MISC" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                MISC
              </span>
            </div>
          </a>
        
        
          <a href="../log-04-2018/" title="April 2018" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                April 2018
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/application.abd7b172.js"></script>
      
      <script>app.initialize({version:"0.17.2",url:{base:"../../.."}})</script>
      
    
    
      
    
  </body>
</html>